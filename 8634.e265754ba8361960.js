"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8634],{2431:(j,T,a)=>{a.d(T,{m:()=>g});var p=a(467),t=a(4412),A=a(5312),v=a(5083),b=a(4438),M=a(1626),O=a(671),y=a(3117);let g=(()=>{var E;class m{constructor(n,s,c){this.http=n,this.authService=s,this.employeeService=c,this.cartKey="cart",this.cartSubject=new t.t(this.getCart()),this.cart$=this.cartSubject.asObservable(),this.inactivityTime=0,this.inactivityLimit=600,this.userId=null,this.lastNotificationKey="lastCartAbandonmentNotification",sessionStorage.getItem(this.cartKey)||sessionStorage.setItem(this.cartKey,JSON.stringify([])),this.authService.isLoggedIn().subscribe(l=>{l&&this.authService.getUserInfo().subscribe(d=>{d&&(this.userId=d.id,sessionStorage.removeItem(this.lastNotificationKey),this.setupTracking())})})}setupTracking(){document.addEventListener("mousemove",()=>this.resetInactivity()),document.addEventListener("keypress",()=>this.resetInactivity());const n=()=>{this.inactivityTime+=1,this.inactivityTime>this.inactivityLimit&&this.getCart().length>0&&this.handleAbandonedCart(),this.inactivityTimer=setTimeout(n,1e3)};n()}ngOnDestroy(){this.inactivityTimer&&clearTimeout(this.inactivityTimer)}resetInactivity(){0===this.getCart().length&&sessionStorage.removeItem(this.lastNotificationKey),this.inactivityTime>0&&(this.inactivityTime=0)}handleAbandonedCart(){const n=this.getCart(),s=sessionStorage.getItem(this.lastNotificationKey);n.length>0&&this.userId&&!s&&(this.sendCartAbandonmentNotification(this.userId),sessionStorage.setItem(this.lastNotificationKey,"sent"))}sendCartAbandonmentNotification(n){return(0,p.A)(function*(){const s={userId:n,title:"Forget To Checkout?",body:"Come back to checkout and feel the power of the flower!"},c=localStorage.getItem("sessionData"),d={Authorization:c?JSON.parse(c).token:null,"Content-Type":"application/json"};try{const u=yield v.pX.post({url:`${A.c.apiUrl}/notifications/send-push`,headers:d,data:s});console.log("Cart abandonment notification sent",u)}catch(u){console.error("Error sending notification",u)}})()}getCart(){const n=sessionStorage.getItem(this.cartKey);return n?JSON.parse(n):[]}addToCart(n){const s=this.getCart(),c=s.findIndex(l=>l.id===n.id);-1!==c?s[c].quantity+=n.quantity:s.push(n),this.saveCart(s)}updateQuantity(n,s){const c=this.getCart(),l=c.findIndex(d=>d.id===n);-1!==l&&(c[l].quantity=s,c[l].quantity<=0&&c.splice(l,1),this.saveCart(c))}removeFromCart(n){const c=this.getCart().filter(l=>l.id!==n);this.saveCart(c)}clearCart(){this.saveCart([])}checkout(n,s,c){var l=this;const u=[...this.getCart()],i=[];let _,h=0,e=0,o=0,f=[];const S=function(){var P=(0,p.A)(function*(){for(;u.length>0;){const C=yield l.fetchInventory(h,5e3);if(C.forEach(D=>{const x=u.findIndex(U=>+U.posProductId===D.id_item);-1!==x&&(i.push({...u[x],id_batch:D.id_batch}),u.splice(x,1))}),h+=5e3,0===C.length)break}return i});return function(){return P.apply(this,arguments)}}(),k=function(){var P=(0,p.A)(function*(){_=yield l.authService.getCurrentUser(),console.log(_)});return function(){return P.apply(this,arguments)}}(),N=function(){var P=(0,p.A)(function*(){const C={id_customer:_.alleaves_customer_id,id_external:null,id_location:1e3,id_status:1,type:s,use_type:"adult",auto_apply_discount_exclusions:[],delivery_address:"delivery"===s?c:null,complete:!1,verified:!1,packed:!1,scheduled:!1};e=(yield l.createOrder(C)).id_order});return function(){return P.apply(this,arguments)}}(),R=function(){var P=(0,p.A)(function*(){o=(yield l.addCheckoutItemsToOrder(e,f)).reduce((D,x)=>D+(x.price||0),0)});return function(){return P.apply(this,arguments)}}(),B=function(){var P=(0,p.A)(function*(){let C=n/20;const D=[...f].sort((x,U)=>U.price-x.price);for(const x of D){if(C<=0)break;const U=Math.min(x.price,C);C-=U;const L=x.price-U,W={url:`https://app.alleaves.com/api/order/${e}/item/${x.id_item}`,method:"PUT",headers:{Authorization:`Bearer ${JSON.parse(sessionStorage.getItem("authTokensAlleaves")||"{}")}`,"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"},data:{price_override:L,price_override_reason:"Points redemption applied"}};yield v.pX.request(W)}});return function(){return P.apply(this,arguments)}}();return(0,p.A)(function*(){try{return yield k(),f=yield S(),yield N(),yield R(),yield B(),{user_info:_,id_order:e,checkoutItems:f,subtotal:o}}catch(P){throw console.error("Checkout process failed:",P),P}})()}saveCart(n){sessionStorage.setItem(this.cartKey,JSON.stringify(n)),this.cartSubject.next(n)}fetchInventory(n,s){return(0,p.A)(function*(){const u={url:"https://app.alleaves.com/api/inventory/search",method:"POST",headers:{Authorization:`Bearer ${JSON.parse(sessionStorage.getItem("authTokensAlleaves")||"{}")}`,"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"},data:{skip:n,take:s}};return v.pX.request(u).then(i=>i.data).catch(i=>{throw console.error("Error fetching inventory:",i),i})})()}createCustomer(n){return(0,p.A)(function*(){const l={url:"https://app.alleaves.com/api/customer",method:"POST",headers:{Authorization:`Bearer ${JSON.parse(sessionStorage.getItem("authTokensAlleaves")||"{}")}`,"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"},data:n};return v.pX.request(l).then(d=>d.data).catch(d=>{throw console.error("Error creating User:",d),d})})()}createOrder(n){return(0,p.A)(function*(){const l={url:"https://app.alleaves.com/api/order",method:"POST",headers:{Authorization:`Bearer ${JSON.parse(sessionStorage.getItem("authTokensAlleaves")||"{}")}`,"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"},data:n};return v.pX.request(l).then(d=>d.data).catch(d=>{throw console.error("Error creating order:",d),d})})()}addCheckoutItemsToOrder(n,s){return(0,p.A)(function*(){const c={Authorization:`Bearer ${JSON.parse(sessionStorage.getItem("authTokensAlleaves")||"{}")}`,"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"},l=`https://app.alleaves.com/api/order/${n}/item`,d=s.map(u=>v.pX.request({url:l,method:"POST",headers:c,data:{id_batch:u.id_batch,id_area:1e3,qty:u.quantity}}).then(r=>r.data.items.map(o=>({...u,id_item:o.id_item}))).catch(r=>{throw console.error(`Error adding item (id_batch: ${u.id_batch}):`,r),r}));return Promise.all(d).then(u=>u.flat()).catch(u=>{throw console.error("Error processing items:",u),u})})()}placeOrder(n,s,c,l,d,u){var i=this;return(0,p.A)(function*(){const h=i.employeeService.getSelectedUser(),e={user_id:n,pos_order_id:s,points_add:c,points_redeem:l,amount:d,cart:u};h&&h.id&&(e.employee_id=i.authService.getCurrentUser().id);const o=localStorage.getItem("sessionData"),_=o?JSON.parse(o).token:null;if(!_)throw new Error("No user logged in");return v.pX.request({url:`${A.c.apiUrl}/orders/create`,method:"POST",headers:{Authorization:_,"Content-Type":"application/json",Accept:"application/json"},data:e}).then(k=>k.data).catch(k=>{throw console.error("Error in placeOrder:",k),k})})()}updateOrder(n,s,c,l,d){return(0,p.A)(function*(){const u={id_order:n,pickup_date:s,pickup_time:c,id_customer:d,id_location:1e3},i={Authorization:`Bearer ${JSON.parse(sessionStorage.getItem("authTokensAlleaves")||"{}")}`,"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"};return v.pX.request({url:`https://app.alleaves.com/api/order/${n}`,method:"PUT",headers:i,data:u}).then(r=>r.data).catch(r=>{throw console.error("Error in updateOrder:",r),r})})()}createAlleavesCustomer(n){return(0,p.A)(function*(){try{const s={method:"POST",url:"https://app.alleaves.com/api/customer",headers:{Authorization:`Bearer ${JSON.parse(sessionStorage.getItem("authTokensAlleaves")||"{}")}`,"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"},data:{name_first:n.fname,name_last:n.lname,phone:n.phone,email:n.email,date_of_birth:n.dob}},c=yield v.pX.request(s);return console.log("External API Response:",c),c.data}catch(s){throw console.error("Error calling Alleaves API:",s),new Error("Failed to create Alleaves customer")}})()}}return(E=m).\u0275fac=function(n){return new(n||E)(b.KVO(M.Qq),b.KVO(O.u),b.KVO(y.O))},E.\u0275prov=b.jDH({token:E,factory:E.\u0275fac,providedIn:"root"}),m})()},3117:(j,T,a)=>{a.d(T,{O:()=>O});var p=a(1626),t=a(4412),A=a(9437),v=a(8810),b=a(5312),M=a(4438);let O=(()=>{var y;class g{constructor(m){this.http=m,this.selectedUserSubject=new t.t(null),this.selectedUser$=this.selectedUserSubject.asObservable()}getHeaders(){const m=localStorage.getItem("sessionData"),I=m?JSON.parse(m).token:null;if(!I)throw console.error("No API key found, user needs to log in."),new Error("Unauthorized: No API key found");return new p.Lr({Authorization:I})}getUserByEmail(m){return this.http.get(`${b.c.apiUrl}/users/email?email=${m}`,{headers:this.getHeaders()}).pipe((0,A.W)(I=>(console.error("Error fetching user by email:",I),(0,v.$)(()=>I))))}getUserByPhone(m){return this.http.get(`${b.c.apiUrl}/users/phone?phone=${m}`,{headers:this.getHeaders()}).pipe((0,A.W)(I=>(console.error("Error fetching user by phone:",I),(0,v.$)(()=>I))))}setSelectedUser(m){this.selectedUserSubject.next(m)}clearSelectedUser(){this.selectedUserSubject.next(null)}getSelectedUser(){return this.selectedUserSubject.getValue()}}return(y=g).\u0275fac=function(m){return new(m||y)(M.KVO(p.Qq))},y.\u0275prov=M.jDH({token:y,factory:y.\u0275fac,providedIn:"root"}),g})()},2152:(j,T,a)=>{a.d(T,{l:()=>u});var p=a(467),t=a(4438),A=a(671),v=a(9216),b=a(2431),M=a(6549),O=a(7423),y=a(177),g=a(4742);const E=()=>({mode:"login"});function m(i,h){1&i&&(t.j41(0,"ion-button",8),t.EFF(1," Log In "),t.k0s()),2&i&&t.Y8G("queryParams",t.lJ4(1,E))}function I(i,h){if(1&i&&(t.j41(0,"ion-badge",16),t.EFF(1),t.k0s()),2&i){const r=t.XpG(2);t.BMQ("aria-label",r.cartItemCount+" items in cart"),t.R7$(),t.SpI(" ",r.cartItemCount," ")}}function n(i,h){if(1&i&&t.nrm(0,"ion-badge",17),2&i){const r=t.XpG(2);t.BMQ("aria-label",r.unreadCount+" unread notifications")}}function s(i,h){if(1&i){const r=t.RV6();t.qex(0),t.j41(1,"ion-label",9),t.EFF(2),t.k0s(),t.j41(3,"ion-button",10),t.nrm(4,"i",11),t.DNE(5,I,2,2,"ion-badge",12),t.k0s(),t.j41(6,"ion-button",13),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.toggleNotifications())}),t.nrm(7,"i",14),t.DNE(8,n,1,1,"ion-badge",15),t.k0s(),t.bVm()}if(2&i){const r=t.XpG();t.R7$(2),t.SpI("",r.userPoints," Points"),t.R7$(3),t.Y8G("ngIf",r.cartItemCount>0),t.R7$(3),t.Y8G("ngIf",r.unreadCount>0)}}function c(i,h){1&i&&(t.j41(0,"div",26),t.EFF(1," No new notifications. "),t.k0s())}function l(i,h){if(1&i){const r=t.RV6();t.j41(0,"div",27),t.bIt("click",function(){const o=t.eBV(r).$implicit,_=t.XpG(2);return t.Njj(_.markAsRead(o))}),t.nrm(1,"ion-icon",28),t.j41(2,"span"),t.EFF(3),t.k0s(),t.j41(4,"ion-button",29),t.bIt("click",function(){const o=t.eBV(r).$implicit,_=t.XpG(2);return t.Njj(_.clearNotification(o))}),t.EFF(5,"Clear"),t.k0s()()}if(2&i){const r=h.$implicit;t.AVh("unread",!r.read),t.R7$(3),t.JRh(r.message)}}function d(i,h){if(1&i){const r=t.RV6();t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title",18),t.EFF(3,"Notifications"),t.k0s(),t.j41(4,"ion-buttons",4)(5,"ion-button",19),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.closeNotifications())}),t.nrm(6,"ion-icon",20),t.k0s()()()(),t.j41(7,"div",21),t.DNE(8,c,2,0,"div",22)(9,l,6,3,"div",23),t.j41(10,"div",24)(11,"ion-button",25),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.clearAllNotifications())}),t.EFF(12," Clear All "),t.k0s()()()}if(2&i){const r=t.XpG();t.R7$(8),t.Y8G("ngIf",0===r.notifications.length),t.R7$(),t.Y8G("ngForOf",r.notifications)}}let u=(()=>{var i;class h{constructor(e,o,_,f,S){this.authService=e,this.settingsService=o,this.cartService=_,this.router=f,this.accessibilityService=S,this.isLoggedIn=!1,this.darkModeEnabled=!1,this.userPoints=0,this.cartItemCount=0,this.showNotifications=!1,this.unreadCount=2,this.notifications=[]}ngOnInit(){var e=this;return(0,p.A)(function*(){e.authService.isLoggedIn().subscribe(function(){var o=(0,p.A)(function*(_){if(e.isLoggedIn=_,_){e.authService.getUserInfo().subscribe(f=>{f&&(e.userPoints=f.points,e.accessibilityService.announce(`You have ${e.userPoints} reward points.`,"polite"))});try{const f=yield e.settingsService.getUserNotifications();e.notifications=f,e.unreadCount=f.filter(S=>"unread"===S.status).length}catch(f){console.error("Error fetching notifications:",f)}}else e.accessibilityService.announce("You are logged out.","polite")});return function(_){return o.apply(this,arguments)}}()),e.settingsService.isDarkModeEnabled$.subscribe(o=>{e.darkModeEnabled=o,e.accessibilityService.announce((o?"Dark mode":"Light mode")+" is enabled.","polite")}),e.cartService.cart$.subscribe(o=>{const _=o.reduce((f,S)=>f+S.quantity,0);e.cartItemCount!==_&&(e.cartItemCount=_,e.accessibilityService.announce(`You have ${e.cartItemCount} items in your cart.`,"polite"))})})()}markAllNotificationsAsRead(){var e=this;return(0,p.A)(function*(){if(e.unreadCount>0)try{yield e.settingsService.markAllNotificationsAsRead(e.authService.getCurrentUser().id),e.notifications.forEach(o=>o.status="read"),e.unreadCount=0}catch(o){console.error("Error marking all notifications as read:",o)}})()}toggleNotifications(){this.showNotifications=!0,this.markAllNotificationsAsRead()}closeNotifications(){this.showNotifications=!1}clearNotification(e){var o=this;return(0,p.A)(function*(){const _=o.notifications.indexOf(e);if(_>-1){o.notifications.splice(_,1),o.unreadCount--;try{yield o.settingsService.deleteNotification(e.id)}catch(f){console.error("Error deleting notification:",f)}}})()}clearAllNotifications(){var e=this;return(0,p.A)(function*(){try{yield e.settingsService.deleteAllNotifications(e.authService.getCurrentUser().id),e.notifications=[],e.unreadCount=0}catch(o){console.error("Error deleting all notifications:",o)}})()}markAsRead(e){e.read||(e.read=!0,this.unreadCount--)}logout(){this.authService.logout(),this.accessibilityService.announce("You have been logged out successfully.","polite")}goToCart(){this.router.navigateByUrl("/cart"),this.accessibilityService.announce("Navigating to your shopping cart.","polite")}}return(i=h).\u0275fac=function(e){return new(e||i)(t.rXU(A.u),t.rXU(v.h),t.rXU(b.m),t.rXU(M.Ix),t.rXU(O.s))},i.\u0275cmp=t.VBU({type:i,selectors:[["app-header"]],decls:9,vars:4,consts:[[1,"heading-container"],["slot","start"],["routerLink","/home","aria-label","Go to home page",1,"action-button"],["alt","Company logo",1,"logo",3,"src"],["slot","end"],["class","action-button","routerLink","/auth","aria-label","Log in to your account",3,"queryParams",4,"ngIf"],[4,"ngIf"],["aria-labelledby","sort-filter-title",3,"ionModalDidDismiss","isOpen"],["routerLink","/auth","aria-label","Log in to your account",1,"action-button",3,"queryParams"],["aria-live","polite",1,"points-display"],["routerLink","/cart","aria-label","View your shopping cart",1,"action-button","cart-button"],[1,"fas","fa-cart-shopping"],["class","cart-badge",4,"ngIf"],["aria-label","View notifications",1,"action-button","notification-button",3,"click"],[1,"fas","fa-bell"],["class","notification-badge",4,"ngIf"],[1,"cart-badge"],[1,"notification-badge"],["id","sort-filter-title"],["aria-label","Close notifications",3,"click"],["slot","icon-only","name","close","aria-hidden","true"],[1,"filters-container"],["class","empty-notifications",4,"ngIf"],["class","notification-item",3,"unread","click",4,"ngFor","ngForOf"],[1,"sticky-footer"],["fill","solid","expand","full",1,"clear-all-button",3,"click"],[1,"empty-notifications"],[1,"notification-item",3,"click"],["name","alert-circle","aria-hidden","true",1,"notification-icon"],["fill","clear","slot","end",3,"click"]],template:function(e,o){1&e&&(t.j41(0,"ion-toolbar",0)(1,"ion-buttons",1)(2,"ion-button",2),t.nrm(3,"img",3),t.k0s()(),t.j41(4,"ion-buttons",4),t.DNE(5,m,2,2,"ion-button",5)(6,s,9,3,"ng-container",6),t.k0s()(),t.j41(7,"ion-modal",7),t.bIt("ionModalDidDismiss",function(){return o.closeNotifications()}),t.DNE(8,d,13,2,"ng-template"),t.k0s()),2&e&&(t.R7$(3),t.Y8G("src",o.darkModeEnabled?"assets/logo-dark-mode.png":"assets/logo.png",t.B4B),t.R7$(2),t.Y8G("ngIf",!o.isLoggedIn),t.R7$(),t.Y8G("ngIf",o.isLoggedIn),t.R7$(),t.Y8G("isOpen",o.showNotifications))},dependencies:[y.Sq,y.bT,g.In,g.Jm,g.QW,g.eU,g.iq,g.he,g.BC,g.ai,g.Sb,g.N7,M.Wk],styles:["img[_ngcontent-%COMP%]{height:55px}.cart-button[_ngcontent-%COMP%]{position:relative;--background: transparent;--box-shadow: none;padding:0}.cart-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:22px;color:var(--ion-color-primary)}.cart-badge[_ngcontent-%COMP%]{position:absolute;top:-4px;right:-6px;background:var(--ion-color-secondary);color:#fff;font-size:10px;font-weight:700;padding:2px 6px;border-radius:50%;min-width:16px;height:16px;display:flex;align-items:center;justify-content:center;box-shadow:0 0 2px #0003}.action-button[_ngcontent-%COMP%]{position:relative;padding:10px}.action-button[_ngcontent-%COMP%]{text-transform:capitalize;--border-radius: 0 !important}.action-button[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#000}.points-display[_ngcontent-%COMP%]{font-size:14px;font-weight:700;margin-left:8px;color:var(--ion-color-primary)}.heading-container[_ngcontent-%COMP%]{position:sticky;top:0;z-index:1;background:#fff;padding:calc(5px + env(safe-area-inset-top)) 5px 5px 5px;box-shadow:0 2px 4px #0000001a}ion-icon[name=cart-outline][_ngcontent-%COMP%]{font-size:24px;color:var(--ion-color-primary)}.notification-button[_ngcontent-%COMP%]{position:relative;--background: transparent;--box-shadow: none;padding:0}.notification-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:22px;color:var(--ion-color-primary)}.notification-badge[_ngcontent-%COMP%]{position:absolute;top:-4px;right:-6px;background:var(--ion-color-secondary);color:#fff;font-size:10px;font-weight:700;padding:2px 6px;border-radius:50%;min-width:16px;height:16px;display:flex;align-items:center;justify-content:center;box-shadow:0 0 2px #0003}.modal-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;background-color:#f7f7f7;border-radius:10px;padding:10px;overflow:hidden}.notification-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;padding:16px}.clear-all-button[_ngcontent-%COMP%]{margin:0;color:#fff;font-weight:700;border-radius:8px;box-shadow:0 2px 5px #0000001a}.sticky-footer[_ngcontent-%COMP%]{position:sticky;margin-top:10px;bottom:0;background:#fff;padding:10px;border-top:1px solid #ddd;box-shadow:0 -2px 4px #0000001a;z-index:10}.notification-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:6px;box-shadow:0 2px 4px #0000001a;cursor:pointer;font-size:14px;transition:background .3s ease}.notification-item.unread[_ngcontent-%COMP%]{font-weight:700}.notification-item[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.notification-icon[_ngcontent-%COMP%]{font-size:18px;margin-right:12px;color:var(--ion-color-primary)}ion-button.clear[_ngcontent-%COMP%]{font-size:12px;color:var(--ion-color-danger);padding:0;margin-left:12px}.empty-notifications[_ngcontent-%COMP%]{text-align:center;color:#aaa;font-size:16px}"]}),h})()},3887:(j,T,a)=>{a.d(T,{G:()=>M});var p=a(177),t=a(4742),A=a(4341),v=a(6549),b=a(4438);let M=(()=>{var O;class y{}return(O=y).\u0275fac=function(E){return new(E||O)},O.\u0275mod=b.$C({type:O}),O.\u0275inj=b.G2t({imports:[p.MD,t.bv,A.YN,v.iI,A.X1]}),y})()}}]);