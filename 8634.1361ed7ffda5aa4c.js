"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8634],{2431:(N,k,a)=>{a.d(k,{m:()=>g});var u=a(467),t=a(4412),x=a(5312),y=a(5083),b=a(4438),S=a(1626),O=a(671),C=a(3117);let g=(()=>{var E;class v{constructor(i,s,c){this.http=i,this.authService=s,this.employeeService=c,this.cartKey="cart",this.cartSubject=new t.t(this.getCart()),this.cart$=this.cartSubject.asObservable(),this.inactivityTime=0,this.inactivityLimit=600,this.userId=null,this.lastNotificationKey="lastCartAbandonmentNotification",sessionStorage.getItem(this.cartKey)||sessionStorage.setItem(this.cartKey,JSON.stringify([])),this.authService.isLoggedIn().subscribe(d=>{d&&this.authService.getUserInfo().subscribe(l=>{l&&(this.userId=l.id,sessionStorage.removeItem(this.lastNotificationKey),this.setupTracking())})})}setupTracking(){document.addEventListener("mousemove",()=>this.resetInactivity()),document.addEventListener("keypress",()=>this.resetInactivity());const i=()=>{this.inactivityTime+=1,this.inactivityTime>this.inactivityLimit&&this.getCart().length>0&&this.handleAbandonedCart(),this.inactivityTimer=setTimeout(i,1e3)};i()}ngOnDestroy(){this.inactivityTimer&&clearTimeout(this.inactivityTimer)}resetInactivity(){0===this.getCart().length&&sessionStorage.removeItem(this.lastNotificationKey),this.inactivityTime>0&&(this.inactivityTime=0)}handleAbandonedCart(){const i=this.getCart(),s=sessionStorage.getItem(this.lastNotificationKey);i.length>0&&this.userId&&!s&&(this.sendCartAbandonmentNotification(this.userId),sessionStorage.setItem(this.lastNotificationKey,"sent"))}sendCartAbandonmentNotification(i){return(0,u.A)(function*(){const s={userId:i,title:"Forget To Checkout?",body:"Come back to checkout and feel the power of the flower!"},c=localStorage.getItem("sessionData"),l={Authorization:c?JSON.parse(c).token:null,"Content-Type":"application/json"};try{const h=yield y.pX.post({url:`${x.c.apiUrl}/notifications/send-push`,headers:l,data:s});console.log("Cart abandonment notification sent",h)}catch(h){console.error("Error sending notification",h)}})()}getCart(){const i=sessionStorage.getItem(this.cartKey);return i?JSON.parse(i):[]}addToCart(i){const s=this.getCart(),c=s.findIndex(d=>d.id===i.id);-1!==c?s[c].quantity+=i.quantity:s.push(i),this.saveCart(s)}updateQuantity(i,s){const c=this.getCart(),d=c.findIndex(l=>l.id===i);-1!==d&&(c[d].quantity=s,c[d].quantity<=0&&c.splice(d,1),this.saveCart(c))}removeFromCart(i){const c=this.getCart().filter(d=>d.id!==i);this.saveCart(c)}clearCart(){this.saveCart([])}checkout(i,s,c,d){var l=this;const h=this.getCart();let r,n=0,_=0,e=[...h];const o=function(){var P=(0,u.A)(function*(){r=yield l.authService.getCurrentUser(),console.log(r)});return function(){return P.apply(this,arguments)}}(),p=function(){var P=(0,u.A)(function*(){const m={id_customer:d,id_external:null,id_location:1e3,id_status:1,type:s,use_type:"adult",auto_apply_discount_exclusions:[],delivery_address:"delivery"===s?c:null,complete:!1,verified:!1,packed:!1,scheduled:!1};n=(yield l.createOrder(m)).id_order});return function(){return P.apply(this,arguments)}}(),f=function(){var P=(0,u.A)(function*(){const m=yield l.addCheckoutItemsToOrder(n,e);console.log("Responses: ",m);let D=0;e=e.flatMap(A=>{const T=[];for(let U=0;U<A.quantity;U++)m[D]&&(T.push({...A,id_item:m[D].id_item}),D++);return T}),console.log("Updated Checkout Items: ",e),_=e.reduce((A,T)=>A+(T.price||0),0)});return function(){return P.apply(this,arguments)}}(),M=function(){var P=(0,u.A)(function*(){let m=i/20;const D=[...e].sort((A,T)=>T.price-A.price);for(const A of D){if(m<=0)break;const T=Math.min(Number(A.price),m);m-=T;const U=Number(A.price)-T,B={url:`https://app.alleaves.com/api/order/${n}/item/${A.posProductId}`,method:"PUT",headers:{Authorization:`Bearer ${JSON.parse(sessionStorage.getItem("authTokensAlleaves")||"{}")}`,"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"},data:{price_override:U,price_override_reason:"Points redemption applied"}};yield y.pX.request(B)}});return function(){return P.apply(this,arguments)}}();return(0,u.A)(function*(){try{return yield o(),yield p(),yield f(),yield M(),{user_info:r,id_order:n,checkoutItems:e,subtotal:_}}catch(P){throw console.error("Checkout process failed:",P),P}})()}saveCart(i){sessionStorage.setItem(this.cartKey,JSON.stringify(i)),this.cartSubject.next(i)}fetchInventory(i,s){return(0,u.A)(function*(){console.log(sessionStorage.getItem("authTokensAlleaves"));const h={url:"https://app.alleaves.com/api/inventory/search",method:"POST",headers:{Authorization:`Bearer ${JSON.parse(sessionStorage.getItem("authTokensAlleaves")||"{}")}`,"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"},data:{skip:i,take:s}};return y.pX.request(h).then(n=>n.data).catch(n=>{throw console.error("Error fetching inventory:",n),n})})()}createCustomer(i){return(0,u.A)(function*(){const d={url:"https://app.alleaves.com/api/customer",method:"POST",headers:{Authorization:`Bearer ${JSON.parse(sessionStorage.getItem("authTokensAlleaves")||"{}")}`,"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"},data:i};return y.pX.request(d).then(l=>l.data).catch(l=>{throw console.error("Error creating User:",l),l})})()}createOrder(i){return(0,u.A)(function*(){const d={url:"https://app.alleaves.com/api/order",method:"POST",headers:{Authorization:`Bearer ${JSON.parse(sessionStorage.getItem("authTokensAlleaves")||"{}")}`,"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"},data:i};return y.pX.request(d).then(l=>l.data).catch(l=>{throw console.error("Error creating order:",l),l})})()}addCheckoutItemsToOrder(i,s){return(0,u.A)(function*(){const c={Authorization:`Bearer ${JSON.parse(sessionStorage.getItem("authTokensAlleaves")||"{}")}`,"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"},d=`https://app.alleaves.com/api/order/${i}/item`,l=[];for(const n of s){const r={url:d,method:"POST",headers:c,data:{id_batch:n.id_batch,id_area:1e3,qty:n.quantity}};try{var h;const e=yield y.pX.request(r);(null==e||null===(h=e.data)||void 0===h||null===(h=h.items)||void 0===h?void 0:h.length)>0?e.data.items.forEach(o=>{l.some(f=>f.id_item===o.id_item)||l.push({...n,id_item:o.id_item})}):console.warn(`Unexpected response format for item ${n.id_batch}:`,e)}catch(e){console.error(`Error adding item (id_batch: ${n.id_batch}):`,e);continue}}return l})()}placeOrder(i,s,c,d,l,h){var n=this;return(0,u.A)(function*(){const _=n.employeeService.getSelectedUser(),r=n.authService.getCurrentUser(),e=n.authService.isGuest(),o={pos_order_id:s,points_add:c,points_redeem:d,amount:l,cart:h};!e&&null!=_&&_.id?(o.user_id=_.id,o.employee_id=r.id):!e&&"employee"===(null==r?void 0:r.role)||"admin"===(null==r?void 0:r.role)?(o.user_id=562,o.employee_id=r.id):e?(o.user_id=562,o.employee_id=562):(o.user_id=r.id,o.employee_id=562);const p=localStorage.getItem("sessionData"),f=p?JSON.parse(p).token:null,M={"Content-Type":"application/json",Accept:"application/json"};if(n.authService.isGuest())M["x-auth-api-key"]=x.c.db_api_key;else{if(!f)throw console.error("No authentication token found"),new Error("Unauthorized: No API key or token found");M.Authorization=`${f}`}return y.pX.request({url:`${x.c.apiUrl}/orders/create`,method:"POST",headers:M,data:o}).then(m=>(n.clearCart(),m.data)).catch(m=>{throw console.error("Error in placeOrder:",m),m})})()}updateOrder(i,s,c,d,l){return(0,u.A)(function*(){const h={id_order:i,pickup_date:s,pickup_time:c,id_customer:l,id_location:1e3},n={Authorization:`Bearer ${JSON.parse(sessionStorage.getItem("authTokensAlleaves")||"{}")}`,"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"};return y.pX.request({url:`https://app.alleaves.com/api/order/${i}`,method:"PUT",headers:n,data:h}).then(r=>r.data).catch(r=>{throw console.error("Error in updateOrder:",r),r})})()}createAlleavesCustomer(i){return(0,u.A)(function*(){try{const s={method:"POST",url:"https://app.alleaves.com/api/customer",headers:{Authorization:`Bearer ${JSON.parse(sessionStorage.getItem("authTokensAlleaves")||"{}")}`,"Content-Type":"application/json; charset=utf-8",Accept:"application/json; charset=utf-8"},data:{name_first:i.fname,name_last:i.lname,phone:i.phone,email:i.email,date_of_birth:i.dob}},c=yield y.pX.request(s);return console.log("External API Response:",c),c.data}catch(s){throw console.error("Error calling Alleaves API:",s),new Error("Failed to create Alleaves customer")}})()}}return(E=v).\u0275fac=function(i){return new(i||E)(b.KVO(S.Qq),b.KVO(O.u),b.KVO(C.O))},E.\u0275prov=b.jDH({token:E,factory:E.\u0275fac,providedIn:"root"}),v})()},3117:(N,k,a)=>{a.d(k,{O:()=>O});var u=a(1626),t=a(4412),x=a(9437),y=a(8810),b=a(5312),S=a(4438);let O=(()=>{var C;class g{constructor(v){this.http=v,this.selectedUserSubject=new t.t(null),this.selectedUser$=this.selectedUserSubject.asObservable()}getHeaders(){const v=localStorage.getItem("sessionData"),I=v?JSON.parse(v).token:null;if(!I)throw console.error("No API key found, user needs to log in."),new Error("Unauthorized: No API key found");return new u.Lr({Authorization:I})}getUserByEmail(v){return this.http.get(`${b.c.apiUrl}/users/email?email=${v}`,{headers:this.getHeaders()}).pipe((0,x.W)(I=>(console.error("Error fetching user by email:",I),(0,y.$)(()=>I))))}getUserByPhone(v){return this.http.get(`${b.c.apiUrl}/users/phone?phone=${v}`,{headers:this.getHeaders()}).pipe((0,x.W)(I=>(console.error("Error fetching user by phone:",I),(0,y.$)(()=>I))))}setSelectedUser(v){this.selectedUserSubject.next(v)}clearSelectedUser(){this.selectedUserSubject.next(null)}getSelectedUser(){return this.selectedUserSubject.getValue()}}return(C=g).\u0275fac=function(v){return new(v||C)(S.KVO(u.Qq))},C.\u0275prov=S.jDH({token:C,factory:C.\u0275fac,providedIn:"root"}),g})()},2152:(N,k,a)=>{a.d(k,{l:()=>h});var u=a(467),t=a(4438),x=a(671),y=a(9216),b=a(2431),S=a(6549),O=a(7423),C=a(177),g=a(4742);const E=()=>({mode:"login"});function v(n,_){1&n&&(t.j41(0,"ion-button",11),t.EFF(1," Log In "),t.k0s()),2&n&&t.Y8G("queryParams",t.lJ4(1,E))}function I(n,_){if(1&n&&(t.j41(0,"ion-label",12),t.EFF(1),t.k0s()),2&n){const r=t.XpG();t.R7$(),t.SpI("Welcome ",r.userName," -")}}function i(n,_){if(1&n&&(t.j41(0,"ion-label",12),t.EFF(1),t.k0s()),2&n){const r=t.XpG();t.R7$(),t.SpI(" ",r.userPoints," Points")}}function s(n,_){if(1&n&&(t.j41(0,"ion-badge",13),t.EFF(1),t.k0s()),2&n){const r=t.XpG();t.BMQ("aria-label",r.cartItemCount+" items in cart"),t.R7$(),t.SpI(" ",r.cartItemCount," ")}}function c(n,_){1&n&&(t.j41(0,"div",22),t.EFF(1," No new notifications. "),t.k0s())}function d(n,_){if(1&n){const r=t.RV6();t.j41(0,"div",23),t.bIt("click",function(){const o=t.eBV(r).$implicit,p=t.XpG(2);return t.Njj(p.markAsRead(o))}),t.nrm(1,"ion-icon",24),t.j41(2,"span"),t.EFF(3),t.k0s(),t.j41(4,"ion-button",25),t.bIt("click",function(){const o=t.eBV(r).$implicit,p=t.XpG(2);return t.Njj(p.clearNotification(o))}),t.EFF(5,"Clear"),t.k0s()()}if(2&n){const r=_.$implicit;t.AVh("unread",!r.read),t.R7$(3),t.JRh(r.message)}}function l(n,_){if(1&n){const r=t.RV6();t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title",14),t.EFF(3,"Notifications"),t.k0s(),t.j41(4,"ion-buttons",4)(5,"ion-button",15),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.closeNotifications())}),t.nrm(6,"ion-icon",16),t.k0s()()()(),t.j41(7,"div",17),t.DNE(8,c,2,0,"div",18)(9,d,6,3,"div",19),t.j41(10,"div",20)(11,"ion-button",21),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.clearAllNotifications())}),t.EFF(12," Clear All "),t.k0s()()()}if(2&n){const r=t.XpG();t.R7$(8),t.Y8G("ngIf",0===r.notifications.length),t.R7$(),t.Y8G("ngForOf",r.notifications)}}let h=(()=>{var n;class _{constructor(e,o,p,f,M){this.authService=e,this.settingsService=o,this.cartService=p,this.router=f,this.accessibilityService=M,this.isLoggedIn=!1,this.darkModeEnabled=!1,this.userPoints=0,this.cartItemCount=0,this.showNotifications=!1,this.unreadCount=2,this.userName="",this.notifications=[],this.isGuest=!1}ngOnInit(){var e=this;return(0,u.A)(function*(){e.authService.isLoggedIn().subscribe(function(){var o=(0,u.A)(function*(p){e.isLoggedIn=p,p?(e.authService.guest$.subscribe(f=>{e.isGuest=f,console.log(f)}),e.authService.getUserInfo().subscribe(f=>{f&&(e.userPoints=f.points,e.userName=f.fname,e.accessibilityService.announce(`You have ${e.userPoints} reward points.`,"polite"))})):e.accessibilityService.announce("You are logged out.","polite")});return function(p){return o.apply(this,arguments)}}()),e.settingsService.isDarkModeEnabled$.subscribe(o=>{e.darkModeEnabled=o,e.accessibilityService.announce((o?"Dark mode":"Light mode")+" is enabled.","polite")}),e.cartService.cart$.subscribe(o=>{const p=o.reduce((f,M)=>f+M.quantity,0);e.cartItemCount!==p&&(e.cartItemCount=p,e.accessibilityService.announce(`You have ${e.cartItemCount} items in your cart.`,"polite"))})})()}refreshApp(){window.location.reload()}markAllNotificationsAsRead(){var e=this;return(0,u.A)(function*(){if(e.unreadCount>0)try{yield e.settingsService.markAllNotificationsAsRead(e.authService.getCurrentUser().id),e.notifications.forEach(o=>o.status="read"),e.unreadCount=0}catch(o){console.error("Error marking all notifications as read:",o)}})()}toggleNotifications(){this.showNotifications=!0,this.markAllNotificationsAsRead()}closeNotifications(){this.showNotifications=!1}clearNotification(e){var o=this;return(0,u.A)(function*(){const p=o.notifications.indexOf(e);if(p>-1){o.notifications.splice(p,1),o.unreadCount--;try{yield o.settingsService.deleteNotification(e.id)}catch(f){console.error("Error deleting notification:",f)}}})()}clearAllNotifications(){var e=this;return(0,u.A)(function*(){try{yield e.settingsService.deleteAllNotifications(e.authService.getCurrentUser().id),e.notifications=[],e.unreadCount=0}catch(o){console.error("Error deleting all notifications:",o)}})()}markAsRead(e){e.read||(e.read=!0,this.unreadCount--)}logout(){this.authService.logout(),this.accessibilityService.announce("You have been logged out successfully.","polite")}goToCart(){this.router.navigateByUrl("/cart"),this.accessibilityService.announce("Navigating to your shopping cart.","polite")}}return(n=_).\u0275fac=function(e){return new(e||n)(t.rXU(x.u),t.rXU(y.h),t.rXU(b.m),t.rXU(S.Ix),t.rXU(O.s))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-header"]],decls:14,vars:6,consts:[[1,"heading-container"],["slot","start"],["aria-label","Go to home page",1,"action-button",3,"click"],["alt","Company logo",1,"logo",3,"src"],["slot","end"],["class","action-button","routerLink","/auth","aria-label","Log in to your account",3,"queryParams",4,"ngIf"],["class","points-display","aria-live","polite",4,"ngIf"],["routerLink","/cart","aria-label","View your shopping cart",1,"action-button","cart-button"],[1,"fas","fa-cart-shopping"],["class","cart-badge",4,"ngIf"],["aria-labelledby","sort-filter-title",3,"ionModalDidDismiss","isOpen"],["routerLink","/auth","aria-label","Log in to your account",1,"action-button",3,"queryParams"],["aria-live","polite",1,"points-display"],[1,"cart-badge"],["id","sort-filter-title"],["aria-label","Close notifications",3,"click"],["slot","icon-only","name","close","aria-hidden","true"],[1,"filters-container"],["class","empty-notifications",4,"ngIf"],["class","notification-item",3,"unread","click",4,"ngFor","ngForOf"],[1,"sticky-footer"],["fill","solid","expand","full",1,"clear-all-button",3,"click"],[1,"empty-notifications"],[1,"notification-item",3,"click"],["name","alert-circle","aria-hidden","true",1,"notification-icon"],["fill","clear","slot","end",3,"click"]],template:function(e,o){1&e&&(t.j41(0,"ion-toolbar",0)(1,"ion-buttons",1)(2,"ion-button",2),t.bIt("click",function(){return o.refreshApp()}),t.nrm(3,"img",3),t.k0s()(),t.j41(4,"ion-buttons",4),t.DNE(5,v,2,2,"ion-button",5),t.qex(6),t.DNE(7,I,2,1,"ion-label",6)(8,i,2,1,"ion-label",6),t.j41(9,"ion-button",7),t.nrm(10,"i",8),t.DNE(11,s,2,2,"ion-badge",9),t.k0s(),t.bVm(),t.k0s()(),t.j41(12,"ion-modal",10),t.bIt("ionModalDidDismiss",function(){return o.closeNotifications()}),t.DNE(13,l,13,2,"ng-template"),t.k0s()),2&e&&(t.R7$(3),t.Y8G("src",o.darkModeEnabled?"assets/logo-dark-mode.png":"assets/logo.png",t.B4B),t.R7$(2),t.Y8G("ngIf",!o.isLoggedIn||o.isGuest),t.R7$(2),t.Y8G("ngIf",o.isLoggedIn&&!o.isGuest),t.R7$(),t.Y8G("ngIf",o.isLoggedIn&&!o.isGuest),t.R7$(3),t.Y8G("ngIf",o.cartItemCount>0),t.R7$(),t.Y8G("isOpen",o.showNotifications))},dependencies:[C.Sq,C.bT,g.In,g.Jm,g.QW,g.eU,g.iq,g.he,g.BC,g.ai,g.Sb,g.N7,S.Wk],styles:["img[_ngcontent-%COMP%]{height:55px}.cart-button[_ngcontent-%COMP%]{position:relative;--background: transparent;--box-shadow: none;padding:0}.cart-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:22px;color:var(--ion-color-primary)}.cart-badge[_ngcontent-%COMP%]{position:absolute;top:-4px;right:-6px;background:var(--ion-color-secondary);color:#fff;font-size:10px;font-weight:700;padding:2px 6px;border-radius:50%;min-width:16px;height:16px;display:flex;align-items:center;justify-content:center;box-shadow:0 0 2px #0003}.action-button[_ngcontent-%COMP%]{position:relative;padding:10px}.action-button[_ngcontent-%COMP%]{text-transform:capitalize;--border-radius: 0 !important}.action-button[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:#000}.points-display[_ngcontent-%COMP%]{font-size:14px;font-weight:700;margin-left:8px;color:var(--ion-color-primary)}.heading-container[_ngcontent-%COMP%]{position:sticky;top:0;z-index:1;background:#fff;padding:calc(5px + env(safe-area-inset-top)) 5px 5px 5px;box-shadow:0 2px 4px #0000001a}ion-icon[name=cart-outline][_ngcontent-%COMP%]{font-size:24px;color:var(--ion-color-primary)}.notification-button[_ngcontent-%COMP%]{position:relative;--background: transparent;--box-shadow: none;padding:0}.notification-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:22px;color:var(--ion-color-primary)}.notification-badge[_ngcontent-%COMP%]{position:absolute;top:-4px;right:-6px;background:var(--ion-color-secondary);color:#fff;font-size:10px;font-weight:700;padding:2px 6px;border-radius:50%;min-width:16px;height:16px;display:flex;align-items:center;justify-content:center;box-shadow:0 0 2px #0003}.modal-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;background-color:#f7f7f7;border-radius:10px;padding:10px;overflow:hidden}.notification-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;padding:16px}.clear-all-button[_ngcontent-%COMP%]{margin:0;color:#fff;font-weight:700;border-radius:8px;box-shadow:0 2px 5px #0000001a}.sticky-footer[_ngcontent-%COMP%]{position:sticky;margin-top:10px;bottom:0;background:#fff;padding:10px;border-top:1px solid #ddd;box-shadow:0 -2px 4px #0000001a;z-index:10}.notification-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:6px;box-shadow:0 2px 4px #0000001a;cursor:pointer;font-size:14px;transition:background .3s ease}.notification-item.unread[_ngcontent-%COMP%]{font-weight:700}.notification-item[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.notification-icon[_ngcontent-%COMP%]{font-size:18px;margin-right:12px;color:var(--ion-color-primary)}ion-button.clear[_ngcontent-%COMP%]{font-size:12px;color:var(--ion-color-danger);padding:0;margin-left:12px}.empty-notifications[_ngcontent-%COMP%]{text-align:center;color:#aaa;font-size:16px}"]}),_})()},3887:(N,k,a)=>{a.d(k,{G:()=>S});var u=a(177),t=a(4742),x=a(4341),y=a(6549),b=a(4438);let S=(()=>{var O;class C{}return(O=C).\u0275fac=function(E){return new(E||O)},O.\u0275mod=b.$C({type:O}),O.\u0275inj=b.G2t({imports:[u.MD,t.bv,x.YN,y.iI,x.X1]}),C})()}}]);