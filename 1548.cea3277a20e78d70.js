"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1548],{1548:(Ie,T,d)=>{d.r(T),d.d(T,{CartPageModule:()=>Oe});var m=d(177),y=d(4341),l=d(4742),k=d(6549),h=d(467),e=d(4438),P=d(2431),x=d(671),b=d(7423),A=d(3117),E=d(2152);function S(o,s){if(1&o){const r=e.RV6();e.j41(0,"div",4)(1,"div",5),e.nrm(2,"img",6),e.k0s(),e.j41(3,"div",7)(4,"h4"),e.EFF(5),e.k0s(),e.j41(6,"div",8),e.EFF(7),e.nI1(8,"currency"),e.k0s(),e.j41(9,"div",9)(10,"button",10),e.bIt("click",function(){const n=e.eBV(r).$implicit,i=e.XpG();return e.Njj(i.updateQuantity(n,-1))}),e.EFF(11,"-"),e.k0s(),e.j41(12,"span",11),e.EFF(13),e.k0s(),e.j41(14,"button",10),e.bIt("click",function(){const n=e.eBV(r).$implicit,i=e.XpG();return e.Njj(i.updateQuantity(n,1))}),e.EFF(15,"+"),e.k0s()()()()}if(2&o){const r=s.$implicit;e.R7$(2),e.Y8G("src",r.image,e.B4B)("alt","Image of "+r.title),e.R7$(3),e.JRh(r.title),e.R7$(2),e.JRh(e.bMT(8,7,r.price)),e.R7$(3),e.BMQ("aria-label","Decrease quantity of "+r.title),e.R7$(3),e.JRh(r.quantity),e.R7$(),e.BMQ("aria-label","Increase quantity of "+r.title)}}let $=(()=>{var o;class s{constructor(t,n){this.cartService=t,this.accessibilityService=n,this.items=[]}ngOnInit(){this.cartService.cart$.subscribe(t=>{this.items=t})}updateQuantity(t,n){const i=t.quantity+n;this.accessibilityService.announce(i<1?`Removed ${t.title} from your cart.`:`Updated ${t.title} quantity to ${i}.`,"polite"),this.cartService.updateQuantity(t.id,i)}calculateSubtotal(){const t=this.items.reduce((n,i)=>n+Number(i.price)*i.quantity,0);return this.accessibilityService.announce(`Subtotal updated to ${t.toFixed(2)} dollars.`,"polite"),t}}return(o=s).\u0275fac=function(t){return new(t||o)(e.rXU(P.m),e.rXU(b.s))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-cart-items"]],inputs:{items:"items"},decls:10,vars:4,consts:[[1,"cart-container"],["class","cart-item",4,"ngFor","ngForOf"],["routerLink","/home","aria-label","Add more items to your cart",1,"add-more-button"],["aria-live","polite",1,"subtotal"],[1,"cart-item"],[1,"item-image"],[3,"src","alt"],[1,"item-details"],[1,"item-price"],[1,"quantity-controls"],[3,"click"],["aria-live","polite","aria-atomic","true"]],template:function(t,n){1&t&&(e.j41(0,"div",0),e.DNE(1,S,16,9,"div",1),e.j41(2,"ion-button",2),e.EFF(3,"+ Add more items"),e.k0s(),e.j41(4,"div",3)(5,"span"),e.EFF(6,"Subtotal"),e.k0s(),e.j41(7,"span"),e.EFF(8),e.nI1(9,"currency"),e.k0s()()()),2&t&&(e.R7$(),e.Y8G("ngForOf",n.items),e.R7$(7),e.JRh(e.bMT(9,2,n.calculateSubtotal())))},dependencies:[m.Sq,l.Jm,l.N7,k.Wk,m.oe],styles:[".cart-container[_ngcontent-%COMP%]{padding:16px}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:16px}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-image[_ngcontent-%COMP%]{width:125px;height:125px}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;border-radius:8px}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]{flex:1;margin-left:12px}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:14px;margin:0}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .item-price[_ngcontent-%COMP%]{font-weight:700;margin:4px 0}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .quantity-controls[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .quantity-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .quantity-controls[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .quantity-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;width:32px;height:32px;color:var(--ion-color-dark);background-color:#e0e0e0;padding:4px 8px;margin:0 4px;border-radius:4px;cursor:pointer}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .quantity-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#d6d6d6}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .quantity-controls[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{min-width:24px;margin:0 12px;font-weight:700;text-align:center}.cart-container[_ngcontent-%COMP%]   .add-more-button[_ngcontent-%COMP%]{width:100%;cursor:pointer;margin-bottom:16px;text-transform:capitalize}.cart-container[_ngcontent-%COMP%]   .subtotal[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:16px;font-weight:700;padding:16px 0}"]}),s})();window.Aerosync=class{constructor(o){this.iframeDetails={},this.options=o||{},this.options.onLoad=this.options.onLoad||function(){},this.options.onClose=this.options.onClose||function(){},this.options.onSuccess=this.options.onSuccess||function(){},this.options.onEvent=this.options.onEvent||function(){},this.options.onError=this.options.onError||function(){},window.addEventListener("message",this._onPostMessage.bind(this))}launch(){let o="?token="+this.options.token+(this.options.consumerId?`&consumerId=${this.options.consumerId}`:"")+(this.options.deeplink?`&deeplink=${this.options.deeplink}`:"")+(this.options.domain?`&domain=${this.options.domain}`:"")+(this.options.handleMFA?`&handleMFA=${this.options.handleMFA}&jobId=${this.options.jobId}&userId=${this.options.userId}`:""),s=this.options.style&&this.options.style.bgColor&&this.options.style.opacity?this.options.style.bgColor+Math.floor(255*this.options.style.opacity).toString(16):"#000000b2",r="sandbox"===this.options.environment?"https://sandbox.aerosync.com/"+o:"staging"===this.options.environment?"https://staging.aerosync.com/"+o:"dev"===this.options.environment?"https://qa.aerosync.com/"+o:"production"===this.options.environment?"https://www.aerosync.com/"+o:"",t=this.options.style&&this.options.style.width?this.options.style.width:"375px",n=this.options.style&&this.options.style.height?this.options.style.height:"688px",i=document.createElement("iframe"),a=document.createElement("div");this.targetDocument=this.options.targetDocument||document,i.setAttribute("width",t),i.setAttribute("height",n),i.setAttribute("border","0"),i.setAttribute("frame","0"),i.setAttribute("frameborder","0"),i.setAttribute("allowTransparency","true"),i.setAttribute("src",r),i.setAttribute("marginheight","0"),i.setAttribute("marginwidth","0"),i.onload=()=>{this.options.onLoad()},i.setAttribute("title",this.options.iframeTitle),a.setAttribute("id","widget-box"),this.targetElement=this.targetDocument.getElementById(this.options.id),this.targetElement.innerHTML="",this.targetElement.appendChild(a);let c=this.targetDocument.getElementById("widget-box");c.style.display="flex",c.style.position="fixed",c.style.width="100%",c.style.left="0",c.style.top="0",c.style.backgroundColor=s,c.style.zIndex=this.options.zIndex||"1",c.style.height="100%",c.style.justifyContent="center",c.style.alignItems="center",window.matchMedia("(max-height: 700px)").matches&&i.setAttribute("height","95%"),c.innerHTML="",c.appendChild(i),this.iframeDetails={iframe:i}}_onPostMessage(o){let s={};if(this.iframeDetails&&this.iframeDetails.iframe&&o.source===this.iframeDetails.iframe.contentWindow){try{s=JSON.parse(o.data)}catch(r){console.warn("Error processing event",r)}s.type&&this._handleEvent(s)}}_handleEvent(o){switch(o.type){case"pageSuccess":this.options.onSuccess(o.payload);break;case"widgetPageLoaded":this.options.onEvent(o.payload,o.type);break;case"widgetLoaded":this.options.onLoad();break;case"widgetClose":this.targetDocument.querySelector('iframe[title="'+this.options.iframeTitle+'"]').remove(),this.targetDocument.querySelector("#widget-box").remove(),this.options.onClose();break;case"widgetError":this.options.onError(o.payload)}}};var f=d(1626),C=d(8141),g=d(5312);const F={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let I;const B=new Uint8Array(16),p=[];for(let o=0;o<256;++o)p.push((o+256).toString(16).slice(1));const X=function V(o,s,r){var t,n,i,a;if(F.randomUUID&&!s&&!o)return F.randomUUID();const c=null!==(t=null!==(n=(o=o||{}).random)&&void 0!==n?n:null===(i=(a=o).rng)||void 0===i?void 0:i.call(a))&&void 0!==t?t:function D(){if(!I){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");I=crypto.getRandomValues.bind(crypto)}return I(B)}();if(c.length<16)throw new Error("Random bytes length must be >= 16");if(c[6]=15&c[6]|64,c[8]=63&c[8]|128,s){if((r=r||0)<0||r+16>s.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let u=0;u<16;++u)s[r+u]=c[u];return s}return function R(o,s=0){return(p[o[s+0]]+p[o[s+1]]+p[o[s+2]]+p[o[s+3]]+"-"+p[o[s+4]]+p[o[s+5]]+"-"+p[o[s+6]]+p[o[s+7]]+"-"+p[o[s+8]]+p[o[s+9]]+"-"+p[o[s+10]]+p[o[s+11]]+p[o[s+12]]+p[o[s+13]]+p[o[s+14]]+p[o[s+15]]).toLowerCase()}(c)};let N=(()=>{var o;class s{constructor(t){this.http=t,this.merchantToken=null,this.usedForMerchantToken=null}fetchMerchantToken(){const t=new f.Lr({"Content-Type":"application/json",accept:"application/json"});return this.http.post("https://api.aeropay.com/token",{scope:"merchant",api_key:g.c.aeropay_api_key,api_secret:g.c.aeropay_api_secret,id:g.c.aeropay_merchant_id},{headers:t}).pipe((0,C.M)(i=>{i.token&&this.setMerchantToken(i.token,i.TTL)}))}fetchUsedForMerchantToken(t){const n=new f.Lr({"Content-Type":"application/json",accept:"application/json"});return this.http.post("https://api.aeropay.com/token",{scope:"userForMerchant",api_key:g.c.aeropay_api_key,api_secret:g.c.aeropay_api_secret,id:g.c.aeropay_merchant_id,userId:t},{headers:n}).pipe((0,C.M)(a=>{a.token&&this.setUsedForMerchantToken(a.token,a.TTL)}))}setMerchantToken(t,n){this.merchantToken=t}getMerchantToken(){return this.merchantToken}isMerchantTokenValid(){return null!==this.getMerchantToken()}setUsedForMerchantToken(t,n){this.usedForMerchantToken=t}getUsedForMerchantToken(){return this.usedForMerchantToken}isUsedForMerchantTokenValid(){return null!==this.getUsedForMerchantToken()}createUser(t){const n=(new f.Lr).set("Content-Type","application/json").set("accept","application/json").set("X-API-Version","1.1").set("authorizationToken",`Bearer ${this.getMerchantToken()}`);return this.http.post(`${g.c.aeropay_url}/user`,{first_name:t.first_name,last_name:t.last_name,phone_number:t.phone,email:t.email},{headers:n}).pipe((0,C.M)(a=>console.log(a)))}verifyUser(t,n){const i=(new f.Lr).set("Content-Type","application/json").set("accept","application/json").set("authorizationToken",`Bearer ${this.getMerchantToken()}`);return this.http.post(`${g.c.aeropay_url}/confirmUser`,{userId:t,code:n},{headers:i}).pipe((0,C.M)(c=>console.log(c)))}getAerosyncCredentials(){const t=(new f.Lr).set("Content-Type","application/json").set("accept","application/json").set("authorizationToken",`Bearer ${this.getUsedForMerchantToken()}`);return this.http.get(`${g.c.aeropay_url}/aggregatorCredentials?aggregator=aerosync`,{headers:t}).pipe((0,C.M)(n=>console.log(n)))}linkBankAccount(t,n){const i=this.getUsedForMerchantToken();if(!i)throw console.error("Error: No authentication token found."),new Error("Authentication token is missing");const a=(new f.Lr).set("Content-Type","application/json").set("accept","application/json").set("authorizationToken",`Bearer ${i}`),c={user_id:t,user_password:n,aggregator:"aerosync"};return console.log("\u{1f680} Linking Bank Account to AeroPay with Payload:",c),this.http.post(`${g.c.aeropay_url}/linkAccountFromAggregator`,c,{headers:a}).pipe((0,C.M)(u=>console.log(u)))}createTransaction(t,n){const i=this.getUsedForMerchantToken();if(!i)throw console.error("\u274c Error: No authentication token found."),new Error("Authentication token is missing");const a=(new f.Lr).set("Content-Type","application/json").set("accept","application/json").set("authorizationToken",`Bearer ${i}`),c=X(),u={amount:t,id:g.c.aeropay_merchant_id,uuid:c,bankAccountId:n};return console.log("\u{1f680} Initiating AeroPay Transaction with Payload:",u),this.http.post(`${g.c.aeropay_url}/transaction`,u,{headers:a}).pipe((0,C.M)(_=>console.log(_)))}}return(o=s).\u0275fac=function(t){return new(t||o)(e.KVO(f.Qq))},o.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"}),s})();var Y=d(1369);function z(o,s){1&o&&(e.j41(0,"p",9),e.EFF(1,"Name Required."),e.k0s())}function L(o,s){1&o&&(e.j41(0,"div",34),e.nrm(1,"ion-spinner",35),e.j41(2,"p"),e.EFF(3," Fetching AeroPay details..."),e.k0s()())}function q(o,s){if(1&o){const r=e.RV6();e.j41(0,"div",36)(1,"p"),e.EFF(2,"Enter the verification code sent to your email:"),e.k0s(),e.j41(3,"ion-input",37),e.mxI("ngModelChange",function(n){e.eBV(r);const i=e.XpG(2);return e.DH7(i.verificationCode,n)||(i.verificationCode=n),e.Njj(n)}),e.k0s(),e.j41(4,"ion-button",38),e.bIt("click",function(){e.eBV(r);const n=e.XpG(2);return e.Njj(n.verifyAeroPayUser())}),e.EFF(5,"Verify"),e.k0s()()}if(2&o){const r=e.XpG(2);e.R7$(3),e.R50("ngModel",r.verificationCode)}}function J(o,s){1&o&&e.nrm(0,"ion-icon",46)}function Q(o,s){if(1&o){const r=e.RV6();e.j41(0,"ion-item",38),e.bIt("click",function(){const n=e.eBV(r).$implicit,i=e.XpG(3);return e.Njj(i.selectBank(n.bankAccountId))}),e.j41(1,"ion-avatar",43),e.nrm(2,"ion-icon",44),e.k0s(),e.j41(3,"ion-label")(4,"h3"),e.EFF(5),e.k0s(),e.j41(6,"p"),e.EFF(7),e.k0s()(),e.DNE(8,J,1,0,"ion-icon",45),e.k0s()}if(2&o){const r=s.$implicit,t=e.XpG(3);e.AVh("selected-bank",t.selectedBankId===r.bankAccountId),e.R7$(5),e.JRh(r.bankName),e.R7$(2),e.SpI("Checking - ****",r.accountLast4,""),e.R7$(),e.Y8G("ngIf",t.selectedBankId===r.bankAccountId)}}function H(o,s){1&o&&e.nrm(0,"ion-spinner",35)}function W(o,s){1&o&&(e.j41(0,"span"),e.EFF(1,"Connect Another Bank"),e.k0s())}function K(o,s){if(1&o){const r=e.RV6();e.j41(0,"div",39)(1,"ion-list"),e.DNE(2,Q,9,5,"ion-item",40),e.k0s(),e.j41(3,"ion-button",41),e.bIt("click",function(){e.eBV(r);const n=e.XpG(2);return e.Njj(n.retrieveAerosyncCredentials())}),e.DNE(4,H,1,0,"ion-spinner",42)(5,W,2,0,"span",23),e.k0s()()}if(2&o){const r=e.XpG(2);e.R7$(2),e.Y8G("ngForOf",r.userBankAccounts),e.R7$(2),e.Y8G("ngIf",r.loadingAerosync),e.R7$(),e.Y8G("ngIf",!r.loadingAerosync)}}function Z(o,s){if(1&o&&(e.j41(0,"ion-item",17),e.nrm(1,"ion-radio",28),e.j41(2,"ion-label",29),e.nrm(3,"img",30),e.DNE(4,L,4,0,"div",31)(5,q,6,1,"div",32)(6,K,6,3,"div",33),e.k0s()()),2&o){const r=e.XpG();e.R7$(4),e.Y8G("ngIf",r.isFetchingAeroPay),e.R7$(),e.Y8G("ngIf",r.verificationRequired),e.R7$(),e.Y8G("ngIf",r.showBankSelection)}}function ee(o,s){if(1&o){const r=e.RV6();e.qex(0),e.j41(1,"p"),e.EFF(2," Potential Savings: "),e.j41(3,"span"),e.EFF(4),e.nI1(5,"currency"),e.k0s()(),e.j41(6,"p"),e.EFF(7," Points to Redeem: "),e.j41(8,"span"),e.EFF(9),e.k0s()(),e.j41(10,"ion-item",47)(11,"ion-range",48),e.mxI("ngModelChange",function(n){e.eBV(r);const i=e.XpG();return e.DH7(i.pointsToRedeem,n)||(i.pointsToRedeem=n),e.Njj(n)}),e.bIt("ionChange",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.updateTotals())}),e.j41(12,"ion-label",43),e.EFF(13,"0"),e.k0s(),e.j41(14,"ion-label",49),e.EFF(15),e.k0s()()(),e.j41(16,"p"),e.EFF(17," Discount Applied: "),e.j41(18,"span"),e.EFF(19),e.nI1(20,"currency"),e.k0s()(),e.bVm()}if(2&o){const r=e.XpG();e.R7$(4),e.JRh(e.bMT(5,8,r.originalUserInfo.points*r.pointValue)),e.R7$(5),e.JRh(r.pointsToRedeem),e.R7$(2),e.R50("ngModel",r.pointsToRedeem),e.Y8G("min",0)("max",r.originalUserInfo.points)("step",1),e.R7$(4),e.JRh(r.originalUserInfo.points),e.R7$(4),e.JRh(e.bMT(20,10,r.pointsToRedeem*r.pointValue))}}function te(o,s){if(1&o&&(e.j41(0,"li",50),e.nrm(1,"img",51),e.j41(2,"div",52)(3,"span",53),e.EFF(4),e.k0s(),e.j41(5,"span",54),e.EFF(6),e.k0s()()()),2&o){const r=s.$implicit;e.R7$(),e.Y8G("src",r.image,e.B4B)("alt","Image of "+r.title),e.R7$(3),e.SpI("",r.quantity,"x"),e.R7$(2),e.JRh(r.title)}}let ne=(()=>{var o;class s{constructor(t,n,i,a,c,u,_,O){this.cartService=t,this.loadingController=n,this.accessibilityService=i,this.toastController=a,this.authService=c,this.aeropayService=u,this.router=_,this.productsService=O,this.deliveryAddress={street:"",apt:"",city:"",zip:"",state:"NY"},this.isDatePickerOpen=!1,this.selectedDate=null,this.pointsToRedeem=0,this.showTooltip=!1,this.applyPoints=!1,this.finalSubtotal=0,this.finalTotal=0,this.finalTax=0,this.pointValue=.05,this.selectedTime="",this.isLoading=!1,this.timeOptions=[],this.selectedPaymentMethod="cash",this.selectedOrderType="retail",this.enableDelivery=!1,this.aeropayAuthToken=null,this.verificationRequired=!1,this.verificationCode="",this.existingUserId="",this.aerosyncURL=null,this.aerosyncToken=null,this.aerosyncUsername=null,this.showAerosyncWidget=!1,this.userBankAccounts=[],this.showBankSelection=!1,this.selectedBankId=null,this.isFetchingAeroPay=!1,this.bankLinked=!1,this.loadingAerosync=!1,this.originalUserInfo=null,this.showAeropay=!0,this.back=new e.bkB,this.orderPlaced=new e.bkB,this.isGuest=!1,this.originalUserId=0,this.invalidName=!1}ngOnInit(){this.calculateDefaultTotals(),this.generateTimeOptions(),this.authService.guest$.subscribe(t=>{this.isGuest=t,this.showAeropay=!1,console.log(t)}),this.originalUserId=this.checkoutInfo.user_info.id,this.originalAllLeaves=this.checkoutInfo.user_info.alleaves_customer_id,"employee"===this.checkoutInfo.user_info.role?this.showAeropay=!1:"customer"===this.checkoutInfo.user_info.role&&(this.showAeropay=!0),this.authService.getUserInfo().subscribe(t=>{t&&(this.userRole=t.role)}),this.originalUserInfo={...this.checkoutInfo.user_info},this.checkoutInfo.user_info={fname:"",lname:"",email:"",phone:"",dob:""}}startAeroPayProcess(){var t=this;return(0,h.A)(function*(){console.log("Checking if AeroPay Token is valid..."),t.isFetchingAeroPay=!0,t.aeropayService.fetchMerchantToken().subscribe({next:n=>{if(!1===n.success||!n.token)return console.error("AeroPay Authentication Failed:",n.error),t.presentToast(`Authentication Error: ${n.error.message}`,"danger"),void(t.isFetchingAeroPay=!1);t.createAeroPayUser()},error:n=>{console.error("AeroPay Authentication Request Failed:",n),t.presentToast("Authentication request failed. Please try again.","danger"),t.isFetchingAeroPay=!1}})})()}createAeroPayUser(){var t=this;return(0,h.A)(function*(){t.aeropayService.createUser({first_name:t.checkoutInfo.user_info.fname,last_name:t.checkoutInfo.user_info.lname,phone:t.checkoutInfo.user_info.phone,email:t.checkoutInfo.user_info.email}).subscribe({next:i=>{t.isFetchingAeroPay=!1,i.displayMessage?(t.verificationRequired=!0,t.existingUserId=i.existingUser.userId,t.presentToast(i.displayMessage,"warning")):i.success&&i.user&&(t.userBankAccounts=i.user.bankAccounts||[],t.aeropayUserId=i.user.userId,t.userBankAccounts.length>0?(t.showBankSelection=!0,t.selectedBankId=t.userBankAccounts[0].bankAccountId):t.retrieveAerosyncCredentials())},error:i=>{console.error("Error Creating AeroPay User:",i),t.presentToast("Error creating user. Please try again.","danger"),t.isFetchingAeroPay=!1}})})()}verifyAeroPayUser(){var t=this;return(0,h.A)(function*(){t.verificationCode.trim()?t.aeropayService.verifyUser(t.existingUserId,t.verificationCode).subscribe({next:n=>{t.verificationRequired=!1,t.presentToast("Verification successful!","success")},error:n=>{console.error("Verification Failed:",n),t.presentToast("Invalid verification code. Please try again.","danger")}}):t.presentToast("Please enter the verification code.","danger")})()}retrieveAerosyncCredentials(){var t=this;return(0,h.A)(function*(){t.loadingAerosync=!0,t.aeropayService.fetchUsedForMerchantToken(t.aeropayUserId).subscribe({next:n=>{if(!1===n.success||!n.token)return console.error("AeroPay Authentication Failed:",n.error),t.presentToast(`Authentication Error: ${n.error.message}`,"danger"),void(t.loadingAerosync=!1);t.aeropayService.getAerosyncCredentials().subscribe({next:i=>{i.success?(t.aerosyncURL=i.fastlinkURL,t.aerosyncToken=i.token,t.aerosyncUsername=i.username,t.openAerosyncWidget()):console.error("Failed to retrieve Aerosync widget."),t.loadingAerosync=!1},error:i=>{console.error("Error Retrieving Aerosync Widget:",i),t.loadingAerosync=!1}})},error:n=>{console.error("AeroPay Authentication Request Failed:",n),t.presentToast("Authentication request failed. Please try again.","danger"),t.loadingAerosync=!1}})})()}openAerosyncWidget(){this.aerosyncToken?function G(o){return new window.Aerosync(o)}({id:"widget",iframeTitle:"Connect",environment:"production",token:this.aerosyncToken,style:{width:"375px",height:"688px",bgColor:"#000000",opacity:.7},deeplink:"",consumerId:"",onLoad:function(){console.log("AeroSync Widget Loaded")},onSuccess:n=>{n.user_id&&n.user_password?this.linkBankToAeropay(n.user_id,n.user_password):console.error("Missing user credentials in event:",n)},onError:function(n){console.error("AeroSync Error:",n)},onClose:function(){console.log("AeroSync Widget Closed")},onEvent:function(n,i){console.log(n,i)}}).launch():console.error("Missing AeroSync Token")}linkBankToAeropay(t,n){this.aeropayService.linkBankAccount(t,n).subscribe({next:i=>{i.success?(this.presentToast("Bank account linked successfully!","success"),this.createAeroPayUser()):(console.error("Failed to link bank:",i),this.presentToast("Failed to link your bank. Please try again.","danger"))},error:i=>{console.error("Error linking bank account:",i),this.presentToast("An error occurred while linking your bank.","danger")}})}selectBank(t){this.selectedBankId=t}generateTimeOptions(){for(let t=8;t<=23;t++)this.timeOptions.push({value:(t<10?`0${t}`:`${t}`)+":00",display:`${t%12==0?12:t%12}:00 ${t<12?"AM":"PM"}`})}calculateDefaultTotals(){console.log(this.checkoutInfo.cart),this.finalSubtotal=this.checkoutInfo.cart.reduce((t,n)=>t+n.price*n.quantity,0),this.finalTax=.13*this.finalSubtotal,this.finalTotal=this.finalSubtotal+this.finalTax,this.updateTotals()}updateTotals(){const t=this.pointsToRedeem*this.pointValue,n=this.checkoutInfo.cart.reduce((i,a)=>i+a.price*a.quantity,0);this.finalSubtotal=n-t,this.finalSubtotal<0&&(this.finalSubtotal=0),this.finalTax=.13*this.finalSubtotal,this.finalTotal=this.finalSubtotal+this.finalTax,this.finalTotal>=90&&(this.enableDelivery=!0),this.accessibilityService.announce(`Subtotal updated to ${this.finalSubtotal.toFixed(2)} dollars.`,"polite")}goBack(){this.back.emit(),this.accessibilityService.announce("Returned to the previous page.","polite")}toggleDatePicker(){this.isDatePickerOpen=!this.isDatePickerOpen,this.accessibilityService.announce(this.isDatePickerOpen?"Date picker opened.":"Date picker closed.","polite")}toggleTooltip(){this.showTooltip=!this.showTooltip}onDateSelected(t){const n=new Date(t.detail.value);this.selectedDate=n.toLocaleDateString(void 0,{month:"long",day:"numeric"}),this.showTooltip=!1,this.accessibilityService.announce(`Selected date is ${this.selectedDate}.`,"polite")}placeOrder(){var t=this;return(0,h.A)(function*(){if(""===t.checkoutInfo.user_info.fname||""===t.checkoutInfo.user_info.lname)return void(t.invalidName=!0);t.isLoading=!0;const n=yield t.loadingController.create({spinner:"crescent",message:"Please wait while we process your order...",cssClass:"custom-loading"});yield n.present();try{var i;console.log("User info changed, creating Alleaves customer...");const a={fname:t.checkoutInfo.user_info.fname,lname:t.checkoutInfo.user_info.lname,phone:t.checkoutInfo.user_info.phone,email:t.checkoutInfo.user_info.email,dob:"1990-01-01"},c=yield t.cartService.createAlleavesCustomer(a);null!=c&&c.id_customer?(console.log("Alleaves Customer Created:",c.id_customer),t.checkoutInfo.user_info.alleaves_customer_id=c.id_customer):console.warn("Failed to create Alleaves Customer"),console.log(t.checkoutInfo.user_info.alleaves_customer_id);const _=t.pointsToRedeem;let O=0,j=0;const ve="delivery"===t.selectedOrderType?{address1:t.deliveryAddress.street.trim(),address2:t.deliveryAddress.apt?t.deliveryAddress.apt.trim():null,city:t.deliveryAddress.city.trim(),state:t.deliveryAddress.state.trim(),zip:t.deliveryAddress.zip.trim(),delivery_date:(new Date).toISOString().split("T")[0]}:null;"aeropay"===t.selectedPaymentMethod&&t.selectedBankId&&t.aeropayService.fetchUsedForMerchantToken(t.aeropayUserId).subscribe({next:(M=(0,h.A)(function*(xe){const v=yield t.aeropayService.createTransaction(t.finalTotal.toFixed(2),t.selectedBankId).toPromise();if(!v||!v.success)return console.error("AeroPay Transaction Failed:",v),t.presentToast("Payment failed. Please try again.","danger"),t.isLoading=!1,void(yield n.dismiss());t.presentToast("Payment successful!","success")}),function(v){return M.apply(this,arguments)}),error:M=>{console.log("Error:",M),t.presentToast("Error","danger")}});const w=yield t.cartService.checkout(_,t.selectedOrderType,ve,null!==(i=t.checkoutInfo.user_info.alleaves_customer_id)&&void 0!==i?i:t.originalAllLeaves);O=w.id_order,j=w.subtotal,yield t.cartService.placeOrder(t.originalUserId,O,_?0:j,_,t.finalSubtotal,t.checkoutInfo.cart),t.orderPlaced.emit(),"employee"!==t.userRole||t.isGuest?t.authService.logout():t.router.navigateByUrl("/rewards"),t.invalidName=!1,t.productsService.fetchProducts().subscribe({next:()=>{console.log("Products fetched successfully.")},error:M=>{console.error("Error fetching products:",M)}}),t.accessibilityService.announce("Your order has been placed successfully.","polite")}catch(a){console.error("Error placing order:",a),yield t.presentToast("Error placing order: "+JSON.stringify(a.message)),t.accessibilityService.announce("There was an error placing your order. Please try again.","polite")}finally{t.isLoading=!1,yield n.dismiss()}var M})()}hasUserInfoChanged(){return!!this.originalUserInfo&&(this.originalUserInfo.fname!==this.checkoutInfo.user_info.fname||this.originalUserInfo.lname!==this.checkoutInfo.user_info.lname||this.originalUserInfo.phone!==this.checkoutInfo.user_info.phone||this.originalUserInfo.email!==this.checkoutInfo.user_info.email||this.originalUserInfo.dob!==this.checkoutInfo.user_info.dob)}presentToast(t,n="danger"){var i=this;return(0,h.A)(function*(){yield(yield i.toastController.create({message:t,duration:5e3,color:n,position:"bottom"})).present()})()}onOrderTypeChange(t){this.selectedOrderType=t.detail.value,"delivery"===this.selectedOrderType&&(this.selectedPaymentMethod="aeropay",this.startAeroPayProcess())}onPaymentMethodChange(t){"aeropay"===t?this.startAeroPayProcess():this.showBankSelection=!1}}return(o=s).\u0275fac=function(t){return new(t||o)(e.rXU(P.m),e.rXU(l.Xi),e.rXU(b.s),e.rXU(l.K_),e.rXU(x.u),e.rXU(N),e.rXU(k.Ix),e.rXU(Y.g))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-checkout"]],inputs:{checkoutInfo:"checkoutInfo"},outputs:{back:"back",orderPlaced:"orderPlaced"},decls:71,vars:22,consts:[[1,"checkout-container"],[1,"header"],["role","button","aria-label","Go back to the previous page",1,"back-button",3,"click"],["name","arrow-back-outline","aria-hidden","true"],[1,"section","contact-info"],["class","required",4,"ngIf"],[1,"input-row"],[1,"rounded-input","half-width"],["position","floating",1,"name-labels",2,"margin-bottom","20px"],[1,"required"],["name","first","placeholder","First Name","aria-label","First Name",3,"ngModelChange","ngModel"],["name","last","placeholder","Last Name","aria-label","Last Name",3,"ngModelChange","ngModel"],[1,"rounded-input"],["name","email","type","email","placeholder","Email","aria-label","Email Address",3,"ngModelChange","ngModel"],["name","phone","type","tel","placeholder","Phone","aria-label","Phone Number",3,"ngModelChange","ngModel"],[1,"section","payment-method"],["aria-label","Select Payment Method",3,"ngModelChange","ngModel"],["lines","none",1,"radio-item"],["slot","start","value","cash",3,"disabled"],["slot","start","value","card",3,"disabled"],["lines","none","class","radio-item",4,"ngIf"],[1,"section","order-summary"],["aria-live","polite",1,"summary"],[4,"ngIf"],[1,"section","cart-items"],["class","order-item",4,"ngFor","ngForOf"],["expand","block","aria-label","Place your order",1,"sticky-footer",3,"click","disabled"],["id","widget"],["slot","start","value","aeropay"],[1,"aeropay-label"],["src","assets/aeropay.png","alt","Powered by Aeropay",1,"aeropay-image"],["class","loading-container",4,"ngIf"],["class","verification-container",4,"ngIf"],["class","aeropay-banks",4,"ngIf"],[1,"loading-container"],["name","crescent"],[1,"verification-container"],["placeholder","Verification Code",3,"ngModelChange","ngModel"],[3,"click"],[1,"aeropay-banks"],[3,"selected-bank","click",4,"ngFor","ngForOf"],["expand","full","color","primary",3,"click"],["name","crescent",4,"ngIf"],["slot","start"],["name","card-outline","size","large"],["name","checkmark-circle","color","success","slot","end",4,"ngIf"],["name","checkmark-circle","color","success","slot","end"],["lines","none",1,"points-slider"],["aria-label","Adjust points to redeem for discount",3,"ngModelChange","ionChange","ngModel","min","max","step"],["slot","end"],[1,"order-item"],[1,"item-image",3,"src","alt"],[1,"item-details"],[1,"item-quantity"],[1,"item-title"]],template:function(t,n){1&t&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.bIt("click",function(){return n.goBack()}),e.nrm(3,"ion-icon",3),e.k0s(),e.j41(4,"h1"),e.EFF(5,"Cart"),e.k0s()(),e.j41(6,"div",4)(7,"h2"),e.EFF(8,"Contact Information"),e.k0s(),e.DNE(9,z,2,0,"p",5),e.j41(10,"form")(11,"div",6)(12,"ion-item",7)(13,"ion-label",8)(14,"span",9),e.EFF(15,"*"),e.k0s()(),e.j41(16,"ion-input",10),e.mxI("ngModelChange",function(a){return e.DH7(n.checkoutInfo.user_info.fname,a)||(n.checkoutInfo.user_info.fname=a),a}),e.k0s()(),e.j41(17,"ion-item",7)(18,"ion-label",8)(19,"span",9),e.EFF(20,"*"),e.k0s()(),e.j41(21,"ion-input",11),e.mxI("ngModelChange",function(a){return e.DH7(n.checkoutInfo.user_info.lname,a)||(n.checkoutInfo.user_info.lname=a),a}),e.k0s()()(),e.j41(22,"ion-item",12)(23,"ion-input",13),e.mxI("ngModelChange",function(a){return e.DH7(n.checkoutInfo.user_info.email,a)||(n.checkoutInfo.user_info.email=a),a}),e.k0s()(),e.j41(24,"ion-item",12)(25,"ion-input",14),e.mxI("ngModelChange",function(a){return e.DH7(n.checkoutInfo.user_info.phone,a)||(n.checkoutInfo.user_info.phone=a),a}),e.k0s()()()(),e.j41(26,"div",15)(27,"h2"),e.EFF(28,"Payment Method"),e.k0s(),e.j41(29,"ion-radio-group",16),e.mxI("ngModelChange",function(a){return e.DH7(n.selectedPaymentMethod,a)||(n.selectedPaymentMethod=a),a}),e.bIt("ngModelChange",function(a){return n.onPaymentMethodChange(a)}),e.j41(30,"ion-item",17),e.nrm(31,"ion-radio",18),e.j41(32,"ion-label"),e.EFF(33,"In Store - Cash"),e.k0s()(),e.j41(34,"ion-item",17),e.nrm(35,"ion-radio",19),e.j41(36,"ion-label"),e.EFF(37,"In Store - Debit"),e.k0s()(),e.DNE(38,Z,7,3,"ion-item",20),e.k0s()(),e.j41(39,"div",21)(40,"h2"),e.EFF(41,"Order Summary"),e.k0s(),e.j41(42,"div",22)(43,"p"),e.EFF(44," Subtotal: "),e.j41(45,"span"),e.EFF(46),e.nI1(47,"currency"),e.k0s()(),e.j41(48,"p"),e.EFF(49," Available Points: "),e.j41(50,"span"),e.EFF(51),e.k0s()(),e.DNE(52,ee,21,12,"ng-container",23),e.j41(53,"p"),e.EFF(54," Tax: "),e.j41(55,"span"),e.EFF(56),e.nI1(57,"currency"),e.k0s()(),e.j41(58,"p"),e.EFF(59," Total: "),e.j41(60,"span"),e.EFF(61),e.nI1(62,"currency"),e.k0s()()()(),e.j41(63,"div",24)(64,"h2"),e.EFF(65,"Your Items"),e.k0s(),e.j41(66,"ul"),e.DNE(67,te,7,4,"li",25),e.k0s()()(),e.j41(68,"ion-button",26),e.bIt("click",function(){return n.placeOrder()}),e.EFF(69," Submit Order\n"),e.k0s(),e.nrm(70,"div",27)),2&t&&(e.R7$(9),e.Y8G("ngIf",n.invalidName),e.R7$(7),e.R50("ngModel",n.checkoutInfo.user_info.fname),e.R7$(5),e.R50("ngModel",n.checkoutInfo.user_info.lname),e.R7$(2),e.R50("ngModel",n.checkoutInfo.user_info.email),e.R7$(2),e.R50("ngModel",n.checkoutInfo.user_info.phone),e.R7$(4),e.R50("ngModel",n.selectedPaymentMethod),e.R7$(2),e.Y8G("disabled","delivery"===n.selectedOrderType),e.R7$(4),e.Y8G("disabled","delivery"===n.selectedOrderType),e.R7$(3),e.Y8G("ngIf",n.showAeropay),e.R7$(8),e.JRh(e.bMT(47,16,n.finalSubtotal)),e.R7$(5),e.JRh(n.originalUserInfo.points),e.R7$(),e.Y8G("ngIf",!n.isGuest),e.R7$(4),e.JRh(e.bMT(57,18,n.finalTax)),e.R7$(5),e.JRh(e.bMT(62,20,n.finalTotal)),e.R7$(6),e.Y8G("ngForOf",n.checkoutInfo.cart),e.R7$(),e.Y8G("disabled","aeropay"===n.selectedPaymentMethod&&!n.selectedBankId))},dependencies:[m.Sq,m.bT,y.qT,y.BC,y.cb,y.vS,y.cV,l.mC,l.Jm,l.iq,l.$w,l.uz,l.he,l.nf,l.KO,l.f0,l.Ob,l.w2,l.su,l.Je,l.Gw,m.oe],styles:[".checkout-container[_ngcontent-%COMP%]{padding:25px;margin-bottom:50px}.checkout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;margin-bottom:16px}.checkout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;font-size:1.2rem;color:#333;transition:color .2s ease-in-out}.checkout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.5rem}.checkout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]:hover{color:#4caf50}.checkout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{flex:1;text-align:center;font-size:2rem;font-weight:700;margin:0}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]{margin-bottom:24px;border-bottom:1px solid #ddd;padding-bottom:16px}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:700;margin-bottom:16px}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   .input-row[_ngcontent-%COMP%]{display:flex;gap:12px}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   .rounded-input[_ngcontent-%COMP%]{border-radius:8px;--padding-start: 12px;margin-bottom:16px;z-index:0}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   .radio-item[_ngcontent-%COMP%]{display:flex;padding:8px;border:1px solid #ddd;border-radius:8px;margin:12px 0 8px;align-items:flex-start;z-index:0}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   .radio-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-left:8px;font-weight:700}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   .radio-item[_ngcontent-%COMP%]   ion-radio[_ngcontent-%COMP%]{--size: 24px}.checkout-container[_ngcontent-%COMP%]   .aeropay-label[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}.checkout-container[_ngcontent-%COMP%]   #aeropay-button-container[_ngcontent-%COMP%]{margin-top:10px}.checkout-container[_ngcontent-%COMP%]   .summary[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:1rem;margin-bottom:8px}.checkout-container[_ngcontent-%COMP%]   .summary[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700}.selected-bank[_ngcontent-%COMP%]{background:#0080001a;border-left:4px solid green;transition:background .3s ease,border-left .3s ease}.sticky-footer[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;width:100%;height:60px;color:#fff;font-size:1.2rem;font-weight:700;display:flex;justify-content:space-between;align-items:center;margin:0;border:none;--border-radius: 0px;z-index:1000}.footer-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.footer-content[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex:1;text-align:center}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.date-time-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px}.date-time-container[_ngcontent-%COMP%]   .date-picker-container[_ngcontent-%COMP%]{position:relative;flex:1;z-index:0}.date-time-container[_ngcontent-%COMP%]   .date-picker-container[_ngcontent-%COMP%]   .tooltip-calendar[_ngcontent-%COMP%]{position:absolute;top:50px;left:0;z-index:1050;background:#fff;border:1px solid #d1d1d1;border-radius:8px;box-shadow:0 4px 8px #0000001a;padding:8px;width:300px}.date-time-container[_ngcontent-%COMP%]   .enhanced-box[_ngcontent-%COMP%]{border-radius:8px;padding:12px;transition:transform .2s ease-in-out,box-shadow .2s ease-in-out}.date-time-container[_ngcontent-%COMP%]   .enhanced-box[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.date-time-container[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{border-radius:8px;--padding-start: 12px;font-size:1rem}.aeropay-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;margin-top:16px}.aeropay-image[_ngcontent-%COMP%]{max-width:60%;margin-top:5px}.loading-container[_ngcontent-%COMP%]{display:flex;margin-top:20px}#widget[_ngcontent-%COMP%]{margin-top:20px}ion-radio[_ngcontent-%COMP%]::part(container){-webkit-appearance:none;-moz-appearance:none;appearance:none;display:inline-flex;width:24px;height:24px;border-radius:50%;border:2px solid #ccc;background-color:#fff}.cart-items[_ngcontent-%COMP%]{margin-top:20px}.cart-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0}.cart-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:15px;border-bottom:1px solid rgba(0,0,0,.3);padding-bottom:10px}.cart-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]   img.item-image[_ngcontent-%COMP%]{width:60px;height:60px;object-fit:cover;border-radius:8px;margin-right:15px}.cart-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]{display:flex;flex-direction:column}.cart-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]   .item-title[_ngcontent-%COMP%]{font-size:14px;font-weight:500}.cart-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]   .item-quantity[_ngcontent-%COMP%]{font-size:13px}.delivery-address[_ngcontent-%COMP%]{margin-top:16px;padding:16px;border-radius:8px;background-color:#f9f9f9;box-shadow:0 2px 5px #0000001a}.delivery-address[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;margin-bottom:12px}.delivery-address[_ngcontent-%COMP%]   .input-row[_ngcontent-%COMP%]{display:flex;gap:12px}.delivery-address[_ngcontent-%COMP%]   .rounded-input[_ngcontent-%COMP%]{border-radius:8px;--padding-start: 12px;margin-bottom:12px}.aeropay-banks[_ngcontent-%COMP%]{width:100%}.required[_ngcontent-%COMP%]{color:red}"]}),s})();var oe=d(5083);function ie(o,s){1&o&&(e.j41(0,"h2"),e.EFF(1,"Pending Orders"),e.k0s())}function re(o,s){1&o&&(e.j41(0,"div",5),e.nrm(1,"ion-spinner",6),e.k0s())}function se(o,s){if(1&o&&(e.j41(0,"li",17),e.nrm(1,"img",18),e.j41(2,"span"),e.EFF(3),e.k0s(),e.j41(4,"span"),e.EFF(5),e.k0s()()),2&o){const r=s.$implicit;e.R7$(),e.Y8G("src",r.image,e.B4B)("alt","Image of "+r.title),e.R7$(2),e.SpI("",r.quantity,"x"),e.R7$(2),e.JRh(r.title)}}function ae(o,s){if(1&o){const r=e.RV6();e.j41(0,"div",14)(1,"ul"),e.DNE(2,se,6,4,"li",15),e.k0s(),e.j41(3,"button",16),e.bIt("click",function(){e.eBV(r);const n=e.XpG().$implicit,i=e.XpG(2);return e.Njj(i.reorder(n))}),e.EFF(4," Reorder "),e.k0s()()}if(2&o){const r=e.XpG().$implicit;e.R7$(2),e.Y8G("ngForOf",r.items),e.R7$(),e.BMQ("aria-label","Reorder items from order"+r.id_order)}}function ce(o,s){if(1&o){const r=e.RV6();e.j41(0,"div",9)(1,"div",10),e.bIt("click",function(){const n=e.eBV(r).index,i=e.XpG(2);return e.Njj(i.toggleExpand(n,"pending"))}),e.j41(2,"div",11)(3,"h3"),e.EFF(4),e.k0s(),e.j41(5,"p"),e.EFF(6),e.k0s()(),e.j41(7,"div",12)(8,"p"),e.EFF(9),e.nI1(10,"number"),e.k0s()()(),e.DNE(11,ae,5,2,"div",13),e.k0s()}if(2&o){const r=s.$implicit,t=s.index,n=e.XpG(2);e.AVh("expanded",n.expandedOrderIndex.pending===t),e.R7$(),e.BMQ("aria-expanded",n.expandedOrderIndex.pending===t)("aria-controls","pending-order-items-"+t)("aria-label","View details for order "+r.id_order),e.R7$(3),e.SpI("Order #",r.id_order,""),e.R7$(2),e.SpI("",r.items.length," items"),e.R7$(3),e.SpI("$",e.i5U(10,9,r.total,"1.2-2"),""),e.R7$(2),e.Y8G("ngIf",n.expandedOrderIndex.pending===t)}}function le(o,s){if(1&o&&(e.j41(0,"div",7),e.DNE(1,ce,12,12,"div",8),e.k0s()),2&o){const r=e.XpG();e.R7$(),e.Y8G("ngForOf",r.pendingOrders)}}function de(o,s){1&o&&(e.j41(0,"h2"),e.EFF(1,"Past Orders"),e.k0s())}function pe(o,s){1&o&&(e.j41(0,"div",5),e.nrm(1,"ion-spinner",6),e.k0s())}function ue(o,s){if(1&o&&(e.j41(0,"li",17),e.nrm(1,"img",18),e.j41(2,"span"),e.EFF(3),e.k0s(),e.j41(4,"span"),e.EFF(5),e.k0s()()),2&o){const r=s.$implicit;e.R7$(),e.Y8G("src",r.image,e.B4B)("alt","Image of "+r.title),e.R7$(2),e.SpI("",r.quantity,"x"),e.R7$(2),e.JRh(r.title)}}function ge(o,s){if(1&o){const r=e.RV6();e.j41(0,"div",14)(1,"ul"),e.DNE(2,ue,6,4,"li",15),e.k0s(),e.j41(3,"ion-button",16),e.bIt("click",function(){e.eBV(r);const n=e.XpG().$implicit,i=e.XpG(2);return e.Njj(i.reorder(n))}),e.EFF(4," Reorder "),e.k0s()()}if(2&o){const r=e.XpG().$implicit;e.R7$(2),e.Y8G("ngForOf",r.items),e.R7$(),e.BMQ("aria-label","Reorder items from order "+r.id_order)}}function he(o,s){if(1&o){const r=e.RV6();e.j41(0,"div",9)(1,"div",10),e.bIt("click",function(){const n=e.eBV(r).index,i=e.XpG(2);return e.Njj(i.toggleExpand(n,"past"))}),e.j41(2,"div",11)(3,"h3"),e.EFF(4),e.k0s(),e.j41(5,"p"),e.EFF(6),e.k0s(),e.j41(7,"p"),e.EFF(8),e.k0s()(),e.j41(9,"div",12)(10,"p"),e.EFF(11),e.nI1(12,"number"),e.k0s()()(),e.DNE(13,ge,5,2,"div",13),e.k0s()}if(2&o){const r=s.$implicit,t=s.index,n=e.XpG(2);e.AVh("expanded",n.expandedOrderIndex.past===t),e.R7$(),e.BMQ("aria-expanded",n.expandedOrderIndex.past===t)("aria-controls","past-order-items-"+t)("aria-label","View details for order "+r.id_order),e.R7$(3),e.SpI("Order #",r.id_order,""),e.R7$(2),e.SpI("",r.items.length," items"),e.R7$(2),e.Lme("Pickup: ",r.pickupDate," at ",r.pickupTime,""),e.R7$(3),e.SpI("$",e.i5U(12,11,r.total,"1.2-2"),""),e.R7$(2),e.Y8G("ngIf",n.expandedOrderIndex.past===t)}}function me(o,s){if(1&o&&(e.j41(0,"div",19),e.DNE(1,he,14,14,"div",8),e.k0s()),2&o){const r=e.XpG();e.R7$(),e.Y8G("ngForOf",r.pastOrders)}}let _e=(()=>{var o;class s{constructor(t,n,i,a){this.authService=t,this.cartService=n,this.accessibilityService=i,this.cdr=a,this.pendingOrders=[],this.pastOrders=[],this.loading=!0,this.expandedOrderIndex={pending:null,past:null},this.isGuest=!1}ngOnInit(){this.loading=!0,this.authService.guest$.subscribe(t=>{this.isGuest=t,console.log(t)}),this.authService.orders.subscribe(t=>{setTimeout(()=>{t.sort((n,i)=>i.id_order-n.id_order),this.pendingOrders=t.filter(n=>!n.complete),this.pastOrders=t.filter(n=>n.complete),this.loading=!1},500)}),this.authService.getUserOrders().then(()=>{console.log("Orders refreshed.")})}getLatestStatus(t){return t.status_list&&t.status_list.length>0?t.status_list.reduce((n,i)=>new Date(i.created_at)>new Date(n.created_at)?i:n).customer_message:""}sendStatusNotification(t,n){return(0,h.A)(function*(){const i={userId:t,title:"Order Update",body:`Your order status: ${n}`},a=localStorage.getItem("sessionData"),u={Authorization:a?JSON.parse(a).token:null,"Content-Type":"application/json"};try{yield oe.pX.post({url:`${g.c.apiUrl}/notifications/send-push`,headers:u,data:i}),console.log("Order status notification sent:",n)}catch(_){console.error("Error sending notification",_)}})()}toggleExpand(t,n){const i=this.expandedOrderIndex[n]===t;this.expandedOrderIndex[n]=i?null:t,this.accessibilityService.announce(i?`Order ${n} #${t+1} collapsed.`:`Order ${n} #${t+1} expanded.`,"polite")}reorder(t){t.items.forEach(i=>{this.cartService.addToCart({id:i.id,posProductId:i.posProductId,image:i.image,brand:i.brand,desc:i.desc,price:i.price,quantity:i.quantity,title:i.title,strainType:i.strainType,thc:i.thc,weight:i.weight,category:i.category})}),this.accessibilityService.announce(`Order #${t.id_order} items have been added to your cart.`,"assertive"),console.log("Order added to cart:",t)}}return(o=s).\u0275fac=function(t){return new(t||o)(e.rXU(x.u),e.rXU(P.m),e.rXU(b.s),e.rXU(e.gRc))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-recent-orders"]],decls:7,vars:6,consts:[[1,"order-history"],[4,"ngIf"],["class","loading-container",4,"ngIf"],["class","order-list","role","region","aria-labelledby","pending-orders-heading",4,"ngIf"],["class","order-list","role","region","aria-labelledby","past-orders-heading",4,"ngIf"],[1,"loading-container"],["name","crescent"],["role","region","aria-labelledby","pending-orders-heading",1,"order-list"],["class","order-card",3,"expanded",4,"ngFor","ngForOf"],[1,"order-card"],[1,"order-header",3,"click"],[1,"order-info"],[1,"order-amount"],["class","order-items",4,"ngIf"],[1,"order-items"],["class","order-item",4,"ngFor","ngForOf"],[1,"reorder-button",3,"click"],[1,"order-item"],[1,"item-image",3,"src","alt"],["role","region","aria-labelledby","past-orders-heading",1,"order-list"]],template:function(t,n){1&t&&(e.j41(0,"div",0),e.DNE(1,ie,2,0,"h2",1)(2,re,2,0,"div",2)(3,le,2,1,"div",3)(4,de,2,0,"h2",1)(5,pe,2,0,"div",2)(6,me,2,1,"div",4),e.k0s()),2&t&&(e.R7$(),e.Y8G("ngIf",!n.loading&&!n.isGuest),e.R7$(),e.Y8G("ngIf",n.loading),e.R7$(),e.Y8G("ngIf",!n.loading&&!n.isGuest),e.R7$(),e.Y8G("ngIf",!n.loading&&!n.isGuest),e.R7$(),e.Y8G("ngIf",n.loading),e.R7$(),e.Y8G("ngIf",!n.loading&&!n.isGuest))},dependencies:[m.Sq,m.bT,l.Jm,l.w2,m.QX],styles:[".order-history[_ngcontent-%COMP%]{width:100%;max-width:600px;margin:0 auto;padding:16px;font-family:Arial,sans-serif}.order-history[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;margin-bottom:24px}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:8px;background-color:#fff;overflow:hidden;transition:max-height .3s ease}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card.expanded[_ngcontent-%COMP%]{max-height:500px}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;cursor:pointer}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-header[_ngcontent-%COMP%]   .order-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;margin:0}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-header[_ngcontent-%COMP%]   .order-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;margin:4px 0}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-header[_ngcontent-%COMP%]   .order-amount[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;margin:0;text-align:right}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-items[_ngcontent-%COMP%]{padding:20px}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:10px}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]   img.item-image[_ngcontent-%COMP%]{width:40px;height:40px;object-fit:cover;border-radius:4px;margin-right:10px}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:10px;font-size:14px}.reorder-button[_ngcontent-%COMP%]{background-color:var(--ion-color-primary);color:#fff;border:none;padding:10px 15px;margin-top:10px;border-radius:5px;cursor:pointer;font-size:14px}.loading-container[_ngcontent-%COMP%]{text-align:center;margin:auto}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:20px;color:#000;text-align:center;margin:auto}"]}),s})();function fe(o,s){if(1&o){const r=e.RV6();e.qex(0),e.nrm(1,"app-cart-items",3),e.j41(2,"div",4)(3,"ion-button",5),e.bIt("click",function(){e.eBV(r);const n=e.XpG(2);return e.Njj(n.checkout())}),e.EFF(4,"Continue"),e.k0s()(),e.bVm()}if(2&o){const r=e.XpG(2);e.R7$(),e.Y8G("items",r.cartItems)}}function Ce(o,s){1&o&&(e.j41(0,"div",6),e.nrm(1,"ion-icon",7),e.j41(2,"p"),e.EFF(3,"Your cart is empty!"),e.k0s(),e.j41(4,"ion-button",8),e.EFF(5,"Browse Products"),e.k0s()())}function ye(o,s){if(1&o&&(e.j41(0,"div"),e.DNE(1,fe,5,1,"ng-container",2)(2,Ce,6,0,"ng-template",null,0,e.C5r),e.nrm(4,"app-recent-orders"),e.k0s()),2&o){const r=e.sdS(3),t=e.XpG();e.R7$(),e.Y8G("ngIf",t.cartItems.length>0)("ngIfElse",r)}}function ke(o,s){if(1&o){const r=e.RV6();e.j41(0,"div")(1,"app-checkout",9),e.bIt("back",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.removeCheckout())})("orderPlaced",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.onOrderPlaced())}),e.k0s()()}if(2&o){const r=e.XpG();e.R7$(),e.Y8G("checkoutInfo",r.checkoutInfo)}}const Me=[{path:"",component:(()=>{var o;class s{constructor(t,n,i,a,c,u){this.cartService=t,this.toastController=n,this.loadingController=i,this.authService=a,this.accessibilityService=c,this.employeeService=u,this.showCheckout=!1,this.showConfirmation=!1,this.checkoutUrl="",this.cartItems=[],this.isLoading=!1,this.isGuest=!1}ngOnInit(){this.cartService.cart$.subscribe(t=>{this.cartItems=t}),this.employeeService.selectedUser$.subscribe(t=>{console.log(t),this.selectedUser=t}),this.authService.guest$.subscribe(t=>{this.isGuest=t})}checkout(){var t=this;return(0,h.A)(function*(){var n;t.isLoading=!0;const i=yield t.loadingController.create({message:"Processing Checkout...",spinner:"crescent"});yield i.present(),console.log(t.selectedUser),t.checkoutInfo={cart:t.cartItems,user_info:t.isGuest?"":null!==(n=t.selectedUser)&&void 0!==n?n:t.authService.getCurrentUser()},console.log(t.checkoutInfo),t.showCheckout=!0,i.dismiss(),t.accessibilityService.announce("Checkout process started.","polite")})()}removeCheckout(){this.showCheckout=!1,this.accessibilityService.announce("Returned to cart.","polite")}onOrderPlaced(){var t=this;return(0,h.A)(function*(){t.showCheckout=!1,yield t.presentToast("Your order has been placed successfully!"),t.resetCart(),t.scrollToTop(),t.accessibilityService.announce("Your order was placed successfully.","polite")})()}ionViewDidEnter(){this.scrollToTop()}scrollToTop(){this.content?this.content.scrollToTop(300):console.warn("IonContent is not available.")}presentToast(t,n="success"){var i=this;return(0,h.A)(function*(){yield(yield i.toastController.create({message:t,duration:5e3,color:n,position:"bottom"})).present()})()}resetCart(){this.cartService.clearCart(),this.cartItems=[],this.checkoutInfo=null,this.accessibilityService.announce("Your cart has been cleared.","polite")}}return(o=s).\u0275fac=function(t){return new(t||o)(e.rXU(P.m),e.rXU(l.K_),e.rXU(l.Xi),e.rXU(x.u),e.rXU(b.s),e.rXU(A.O))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-cart"]],viewQuery:function(t,n){if(1&t&&e.GBs(l.W9,5),2&t){let i;e.mGM(i=e.lsd())&&(n.content=i.first)}},decls:4,vars:2,consts:[["emptyCart",""],[4,"ngIf"],[4,"ngIf","ngIfElse"],[3,"items"],[1,"checkout-container"],["aria-label","Proceed to checkout",1,"checkout-button",3,"click"],["role","alert","aria-live","polite",1,"empty-cart-message"],["name","cart-outline","size","large","aria-hidden","true"],["routerLink","/products","aria-label","Browse available products"],["aria-label","Checkout section",3,"back","orderPlaced","checkoutInfo"]],template:function(t,n){1&t&&(e.j41(0,"ion-content"),e.nrm(1,"app-header"),e.DNE(2,ye,5,2,"div",1)(3,ke,2,1,"div",1),e.k0s()),2&t&&(e.R7$(2),e.Y8G("ngIf",!n.showCheckout&&!n.showConfirmation),e.R7$(),e.Y8G("ngIf",n.showCheckout))},dependencies:[m.bT,l.Jm,l.W9,l.iq,l.N7,k.Wk,E.l,$,ne,_e],styles:[".checkout-container[_ngcontent-%COMP%]{width:100%;text-align:right;padding:16px}.checkout-container[_ngcontent-%COMP%]   .checkout-button[_ngcontent-%COMP%]{text-transform:capitalize;margin-left:auto;width:40%}.empty-cart-message[_ngcontent-%COMP%]{text-align:center;padding:40px 20px}.empty-cart-message[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px;color:#ccc}.empty-cart-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:18px;color:#666;margin-top:10px}.empty-cart-message[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-top:20px}"]}),s})()}];let Pe=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[k.iI.forChild(Me),k.iI]}),s})();var be=d(3887);let Oe=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[m.MD,y.YN,l.bv,Pe,be.G]}),s})()}}]);