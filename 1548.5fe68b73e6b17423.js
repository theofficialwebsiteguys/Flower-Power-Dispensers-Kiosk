"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1548],{1548:(ke,T,d)=>{d.r(T),d.d(T,{CartPageModule:()=>ye});var m=d(177),y=d(4341),l=d(4742),P=d(6549),h=d(467),e=d(4438),b=d(2431),x=d(671),O=d(7423),A=d(3117),w=d(2152);function E(o,a){if(1&o){const r=e.RV6();e.j41(0,"div",4)(1,"div",5),e.nrm(2,"img",6),e.k0s(),e.j41(3,"div",7)(4,"h4"),e.EFF(5),e.k0s(),e.j41(6,"div",8),e.EFF(7),e.nI1(8,"currency"),e.k0s(),e.j41(9,"div",9)(10,"button",10),e.bIt("click",function(){const n=e.eBV(r).$implicit,i=e.XpG();return e.Njj(i.updateQuantity(n,-1))}),e.EFF(11,"-"),e.k0s(),e.j41(12,"span",11),e.EFF(13),e.k0s(),e.j41(14,"button",10),e.bIt("click",function(){const n=e.eBV(r).$implicit,i=e.XpG();return e.Njj(i.updateQuantity(n,1))}),e.EFF(15,"+"),e.k0s()()()()}if(2&o){const r=a.$implicit;e.R7$(2),e.Y8G("src",r.image,e.B4B)("alt","Image of "+r.title),e.R7$(3),e.JRh(r.title),e.R7$(2),e.JRh(e.bMT(8,7,r.price)),e.R7$(3),e.BMQ("aria-label","Decrease quantity of "+r.title),e.R7$(3),e.JRh(r.quantity),e.R7$(),e.BMQ("aria-label","Increase quantity of "+r.title)}}let S=(()=>{var o;class a{constructor(t,n){this.cartService=t,this.accessibilityService=n,this.items=[]}ngOnInit(){this.cartService.cart$.subscribe(t=>{this.items=t})}updateQuantity(t,n){const i=t.quantity+n;this.accessibilityService.announce(i<1?`Removed ${t.title} from your cart.`:`Updated ${t.title} quantity to ${i}.`,"polite"),this.cartService.updateQuantity(t.id,i)}calculateSubtotal(){const t=this.items.reduce((n,i)=>n+Number(i.price)*i.quantity,0);return this.accessibilityService.announce(`Subtotal updated to ${t.toFixed(2)} dollars.`,"polite"),t}}return(o=a).\u0275fac=function(t){return new(t||o)(e.rXU(b.m),e.rXU(O.s))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-cart-items"]],inputs:{items:"items"},decls:10,vars:4,consts:[[1,"cart-container"],["class","cart-item",4,"ngFor","ngForOf"],["routerLink","/home","aria-label","Add more items to your cart",1,"add-more-button"],["aria-live","polite",1,"subtotal"],[1,"cart-item"],[1,"item-image"],[3,"src","alt"],[1,"item-details"],[1,"item-price"],[1,"quantity-controls"],[3,"click"],["aria-live","polite","aria-atomic","true"]],template:function(t,n){1&t&&(e.j41(0,"div",0),e.DNE(1,E,16,9,"div",1),e.j41(2,"ion-button",2),e.EFF(3,"+ Add more items"),e.k0s(),e.j41(4,"div",3)(5,"span"),e.EFF(6,"Subtotal"),e.k0s(),e.j41(7,"span"),e.EFF(8),e.nI1(9,"currency"),e.k0s()()()),2&t&&(e.R7$(),e.Y8G("ngForOf",n.items),e.R7$(7),e.JRh(e.bMT(9,2,n.calculateSubtotal())))},dependencies:[m.Sq,l.Jm,l.N7,P.Wk,m.oe],styles:[".cart-container[_ngcontent-%COMP%]{padding:16px}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:16px}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-image[_ngcontent-%COMP%]{width:125px;height:125px}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;border-radius:8px}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]{flex:1;margin-left:12px}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:14px;margin:0}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .item-price[_ngcontent-%COMP%]{font-weight:700;margin:4px 0}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .quantity-controls[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .quantity-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .quantity-controls[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .quantity-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;width:32px;height:32px;color:var(--ion-color-dark);background-color:#e0e0e0;padding:4px 8px;margin:0 4px;border-radius:4px;cursor:pointer}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .quantity-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#d6d6d6}.cart-container[_ngcontent-%COMP%]   .cart-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]   .quantity-controls[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{min-width:24px;margin:0 12px;font-weight:700;text-align:center}.cart-container[_ngcontent-%COMP%]   .add-more-button[_ngcontent-%COMP%]{width:100%;cursor:pointer;margin-bottom:16px;text-transform:capitalize}.cart-container[_ngcontent-%COMP%]   .subtotal[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:16px;font-weight:700;padding:16px 0}"]}),a})();window.Aerosync=class{constructor(o){this.iframeDetails={},this.options=o||{},this.options.onLoad=this.options.onLoad||function(){},this.options.onClose=this.options.onClose||function(){},this.options.onSuccess=this.options.onSuccess||function(){},this.options.onEvent=this.options.onEvent||function(){},this.options.onError=this.options.onError||function(){},window.addEventListener("message",this._onPostMessage.bind(this))}launch(){let o="?token="+this.options.token+(this.options.consumerId?`&consumerId=${this.options.consumerId}`:"")+(this.options.deeplink?`&deeplink=${this.options.deeplink}`:"")+(this.options.domain?`&domain=${this.options.domain}`:"")+(this.options.handleMFA?`&handleMFA=${this.options.handleMFA}&jobId=${this.options.jobId}&userId=${this.options.userId}`:""),a=this.options.style&&this.options.style.bgColor&&this.options.style.opacity?this.options.style.bgColor+Math.floor(255*this.options.style.opacity).toString(16):"#000000b2",r="sandbox"===this.options.environment?"https://sandbox.aerosync.com/"+o:"staging"===this.options.environment?"https://staging.aerosync.com/"+o:"dev"===this.options.environment?"https://qa.aerosync.com/"+o:"production"===this.options.environment?"https://www.aerosync.com/"+o:"",t=this.options.style&&this.options.style.width?this.options.style.width:"375px",n=this.options.style&&this.options.style.height?this.options.style.height:"688px",i=document.createElement("iframe"),s=document.createElement("div");this.targetDocument=this.options.targetDocument||document,i.setAttribute("width",t),i.setAttribute("height",n),i.setAttribute("border","0"),i.setAttribute("frame","0"),i.setAttribute("frameborder","0"),i.setAttribute("allowTransparency","true"),i.setAttribute("src",r),i.setAttribute("marginheight","0"),i.setAttribute("marginwidth","0"),i.onload=()=>{this.options.onLoad()},i.setAttribute("title",this.options.iframeTitle),s.setAttribute("id","widget-box"),this.targetElement=this.targetDocument.getElementById(this.options.id),this.targetElement.innerHTML="",this.targetElement.appendChild(s);let c=this.targetDocument.getElementById("widget-box");c.style.display="flex",c.style.position="fixed",c.style.width="100%",c.style.left="0",c.style.top="0",c.style.backgroundColor=a,c.style.zIndex=this.options.zIndex||"1",c.style.height="100%",c.style.justifyContent="center",c.style.alignItems="center",window.matchMedia("(max-height: 700px)").matches&&i.setAttribute("height","95%"),c.innerHTML="",c.appendChild(i),this.iframeDetails={iframe:i}}_onPostMessage(o){let a={};if(this.iframeDetails&&this.iframeDetails.iframe&&o.source===this.iframeDetails.iframe.contentWindow){try{a=JSON.parse(o.data)}catch(r){console.warn("Error processing event",r)}a.type&&this._handleEvent(a)}}_handleEvent(o){switch(o.type){case"pageSuccess":this.options.onSuccess(o.payload);break;case"widgetPageLoaded":this.options.onEvent(o.payload,o.type);break;case"widgetLoaded":this.options.onLoad();break;case"widgetClose":this.targetDocument.querySelector('iframe[title="'+this.options.iframeTitle+'"]').remove(),this.targetDocument.querySelector("#widget-box").remove(),this.options.onClose();break;case"widgetError":this.options.onError(o.payload)}}};var _=d(1626),f=d(8141),g=d(5312);const F={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let I;const D=new Uint8Array(16),u=[];for(let o=0;o<256;++o)u.push((o+256).toString(16).slice(1));const V=function G(o,a,r){var t,n,i,s;if(F.randomUUID&&!a&&!o)return F.randomUUID();const c=null!==(t=null!==(n=(o=o||{}).random)&&void 0!==n?n:null===(i=(s=o).rng)||void 0===i?void 0:i.call(s))&&void 0!==t?t:function B(){if(!I){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");I=crypto.getRandomValues.bind(crypto)}return I(D)}();if(c.length<16)throw new Error("Random bytes length must be >= 16");if(c[6]=15&c[6]|64,c[8]=63&c[8]|128,a){if((r=r||0)<0||r+16>a.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let p=0;p<16;++p)a[r+p]=c[p];return a}return function R(o,a=0){return(u[o[a+0]]+u[o[a+1]]+u[o[a+2]]+u[o[a+3]]+"-"+u[o[a+4]]+u[o[a+5]]+"-"+u[o[a+6]]+u[o[a+7]]+"-"+u[o[a+8]]+u[o[a+9]]+"-"+u[o[a+10]]+u[o[a+11]]+u[o[a+12]]+u[o[a+13]]+u[o[a+14]]+u[o[a+15]]).toLowerCase()}(c)};let X=(()=>{var o;class a{constructor(t){this.http=t,this.merchantToken=null,this.usedForMerchantToken=null}fetchMerchantToken(){const t=new _.Lr({"Content-Type":"application/json",accept:"application/json"});return this.http.post("https://staging-api.aeropay.com/token",{scope:"merchant",api_key:g.c.aeropay_api_key,api_secret:g.c.aeropay_api_secret,id:g.c.aeropay_merchant_id},{headers:t}).pipe((0,f.M)(i=>{i.token&&this.setMerchantToken(i.token,i.TTL)}))}fetchUsedForMerchantToken(t){const n=new _.Lr({"Content-Type":"application/json",accept:"application/json"});return this.http.post("https://staging-api.aeropay.com/token",{scope:"userForMerchant",api_key:g.c.aeropay_api_key,api_secret:g.c.aeropay_api_secret,id:g.c.aeropay_merchant_id,userId:t},{headers:n}).pipe((0,f.M)(s=>{s.token&&this.setUsedForMerchantToken(s.token,s.TTL)}))}setMerchantToken(t,n){this.merchantToken=t}getMerchantToken(){return this.merchantToken}isMerchantTokenValid(){return null!==this.getMerchantToken()}setUsedForMerchantToken(t,n){this.usedForMerchantToken=t}getUsedForMerchantToken(){return this.usedForMerchantToken}isUsedForMerchantTokenValid(){return null!==this.getUsedForMerchantToken()}createUser(t){const n=(new _.Lr).set("Content-Type","application/json").set("accept","application/json").set("X-API-Version","1.1").set("authorizationToken",`Bearer ${this.getMerchantToken()}`);return this.http.post(`${g.c.aeropay_url}/user`,{first_name:t.first_name,last_name:t.last_name,phone_number:t.phone,email:t.email},{headers:n}).pipe((0,f.M)(s=>console.log(s)))}verifyUser(t,n){const i=(new _.Lr).set("Content-Type","application/json").set("accept","application/json").set("authorizationToken",`Bearer ${this.getMerchantToken()}`);return this.http.post(`${g.c.aeropay_url}/confirmUser`,{userId:t,code:n},{headers:i}).pipe((0,f.M)(c=>console.log(c)))}getAerosyncCredentials(){const t=(new _.Lr).set("Content-Type","application/json").set("accept","application/json").set("authorizationToken",`Bearer ${this.getUsedForMerchantToken()}`);return this.http.get(`${g.c.aeropay_url}/aggregatorCredentials?aggregator=aerosync`,{headers:t}).pipe((0,f.M)(n=>console.log(n)))}linkBankAccount(t,n){const i=this.getUsedForMerchantToken();if(!i)throw console.error("Error: No authentication token found."),new Error("Authentication token is missing");const s=(new _.Lr).set("Content-Type","application/json").set("accept","application/json").set("authorizationToken",`Bearer ${i}`),c={user_id:t,user_password:n,aggregator:"aerosync"};return console.log("\u{1f680} Linking Bank Account to AeroPay with Payload:",c),this.http.post(`${g.c.aeropay_url}/linkAccountFromAggregator`,c,{headers:s}).pipe((0,f.M)(p=>console.log(p)))}createTransaction(t,n){const i=this.getUsedForMerchantToken();if(!i)throw console.error("\u274c Error: No authentication token found."),new Error("Authentication token is missing");const s=(new _.Lr).set("Content-Type","application/json").set("accept","application/json").set("authorizationToken",`Bearer ${i}`),c=V(),p={amount:t,id:g.c.aeropay_merchant_id,uuid:c,bankAccountId:n};return console.log("\u{1f680} Initiating AeroPay Transaction with Payload:",p),this.http.post(`${g.c.aeropay_url}/transaction`,p,{headers:s}).pipe((0,f.M)(k=>console.log(k)))}}return(o=a).\u0275fac=function(t){return new(t||o)(e.KVO(_.Qq))},o.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"}),a})();function N(o,a){1&o&&(e.j41(0,"p",39),e.EFF(1," Orders must be at least $90 for delivery. "),e.k0s())}function z(o,a){if(1&o){const r=e.RV6();e.j41(0,"div",40)(1,"h3"),e.EFF(2,"Delivery Address"),e.k0s(),e.j41(3,"ion-item",9)(4,"ion-input",41),e.mxI("ngModelChange",function(n){e.eBV(r);const i=e.XpG();return e.DH7(i.deliveryAddress.street,n)||(i.deliveryAddress.street=n),e.Njj(n)}),e.k0s()(),e.j41(5,"ion-item",9)(6,"ion-input",42),e.mxI("ngModelChange",function(n){e.eBV(r);const i=e.XpG();return e.DH7(i.deliveryAddress.apt,n)||(i.deliveryAddress.apt=n),e.Njj(n)}),e.k0s()(),e.j41(7,"div",5)(8,"ion-item",6)(9,"ion-input",43),e.mxI("ngModelChange",function(n){e.eBV(r);const i=e.XpG();return e.DH7(i.deliveryAddress.city,n)||(i.deliveryAddress.city=n),e.Njj(n)}),e.k0s()(),e.j41(10,"ion-item",6)(11,"ion-input",44),e.mxI("ngModelChange",function(n){e.eBV(r);const i=e.XpG();return e.DH7(i.deliveryAddress.zip,n)||(i.deliveryAddress.zip=n),e.Njj(n)}),e.k0s()()(),e.j41(12,"ion-item",45)(13,"ion-label"),e.EFF(14,"State"),e.k0s(),e.j41(15,"ion-text"),e.EFF(16),e.k0s()()()}if(2&o){const r=e.XpG();e.R7$(4),e.R50("ngModel",r.deliveryAddress.street),e.R7$(2),e.R50("ngModel",r.deliveryAddress.apt),e.R7$(3),e.R50("ngModel",r.deliveryAddress.city),e.R7$(2),e.R50("ngModel",r.deliveryAddress.zip),e.R7$(5),e.JRh(r.deliveryAddress.state)}}function Y(o,a){1&o&&(e.j41(0,"div",46),e.nrm(1,"ion-spinner",47),e.j41(2,"p"),e.EFF(3," Fetching AeroPay details..."),e.k0s()())}function L(o,a){if(1&o){const r=e.RV6();e.j41(0,"div",48)(1,"p"),e.EFF(2,"Enter the verification code sent to your email:"),e.k0s(),e.j41(3,"ion-input",49),e.mxI("ngModelChange",function(n){e.eBV(r);const i=e.XpG();return e.DH7(i.verificationCode,n)||(i.verificationCode=n),e.Njj(n)}),e.k0s(),e.j41(4,"ion-button",50),e.bIt("click",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.verifyAeroPayUser())}),e.EFF(5,"Verify"),e.k0s()()}if(2&o){const r=e.XpG();e.R7$(3),e.R50("ngModel",r.verificationCode)}}function J(o,a){1&o&&e.nrm(0,"ion-icon",58)}function q(o,a){if(1&o){const r=e.RV6();e.j41(0,"ion-item",50),e.bIt("click",function(){const n=e.eBV(r).$implicit,i=e.XpG(2);return e.Njj(i.selectBank(n.bankAccountId))}),e.j41(1,"ion-avatar",33),e.nrm(2,"ion-icon",56),e.k0s(),e.j41(3,"ion-label")(4,"h3"),e.EFF(5),e.k0s(),e.j41(6,"p"),e.EFF(7),e.k0s()(),e.DNE(8,J,1,0,"ion-icon",57),e.k0s()}if(2&o){const r=a.$implicit,t=e.XpG(2);e.AVh("selected-bank",t.selectedBankId===r.bankAccountId),e.R7$(5),e.JRh(r.bankName),e.R7$(2),e.SpI("Checking - ****",r.accountLast4,""),e.R7$(),e.Y8G("ngIf",t.selectedBankId===r.bankAccountId)}}function H(o,a){1&o&&e.nrm(0,"ion-spinner",47)}function Q(o,a){1&o&&(e.j41(0,"span"),e.EFF(1,"Connect Another Bank"),e.k0s())}function W(o,a){if(1&o){const r=e.RV6();e.j41(0,"div",51)(1,"ion-list"),e.DNE(2,q,9,5,"ion-item",52),e.k0s(),e.j41(3,"ion-button",53),e.bIt("click",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.retrieveAerosyncCredentials())}),e.DNE(4,H,1,0,"ion-spinner",54)(5,Q,2,0,"span",55),e.k0s()()}if(2&o){const r=e.XpG();e.R7$(2),e.Y8G("ngForOf",r.userBankAccounts),e.R7$(2),e.Y8G("ngIf",r.loadingAerosync),e.R7$(),e.Y8G("ngIf",!r.loadingAerosync)}}function K(o,a){if(1&o&&(e.j41(0,"li",59),e.nrm(1,"img",60),e.j41(2,"div",61)(3,"span",62),e.EFF(4),e.k0s(),e.j41(5,"span",63),e.EFF(6),e.k0s()()()),2&o){const r=a.$implicit;e.R7$(),e.Y8G("src",r.image,e.B4B)("alt","Image of "+r.title),e.R7$(3),e.SpI("",r.quantity,"x"),e.R7$(2),e.JRh(r.title)}}let Z=(()=>{var o;class a{constructor(t,n,i,s,c,p){this.cartService=t,this.loadingController=n,this.accessibilityService=i,this.toastController=s,this.authService=c,this.aeropayService=p,this.deliveryAddress={street:"",apt:"",city:"",zip:"",state:"NY"},this.isDatePickerOpen=!1,this.selectedDate=null,this.pointsToRedeem=0,this.showTooltip=!1,this.applyPoints=!1,this.finalSubtotal=0,this.finalTotal=0,this.finalTax=0,this.pointValue=.05,this.selectedTime="",this.isLoading=!1,this.timeOptions=[],this.selectedPaymentMethod="cash",this.selectedOrderType="pickup",this.enableDelivery=!1,this.aeropayAuthToken=null,this.verificationRequired=!1,this.verificationCode="",this.existingUserId="",this.aerosyncURL=null,this.aerosyncToken=null,this.aerosyncUsername=null,this.showAerosyncWidget=!1,this.userBankAccounts=[],this.showBankSelection=!1,this.selectedBankId=null,this.isFetchingAeroPay=!1,this.bankLinked=!1,this.loadingAerosync=!1,this.originalUserInfo=null,this.back=new e.bkB,this.orderPlaced=new e.bkB}ngOnInit(){this.calculateDefaultTotals(),this.generateTimeOptions(),this.originalUserInfo={...this.checkoutInfo.user_info}}startAeroPayProcess(){var t=this;return(0,h.A)(function*(){console.log("Checking if AeroPay Token is valid..."),t.isFetchingAeroPay=!0,t.aeropayService.fetchMerchantToken().subscribe({next:n=>{if(!1===n.success||!n.token)return console.error("AeroPay Authentication Failed:",n.error),t.presentToast(`Authentication Error: ${n.error.message}`,"danger"),void(t.isFetchingAeroPay=!1);t.createAeroPayUser()},error:n=>{console.error("AeroPay Authentication Request Failed:",n),t.presentToast("Authentication request failed. Please try again.","danger"),t.isFetchingAeroPay=!1}})})()}createAeroPayUser(){var t=this;return(0,h.A)(function*(){t.aeropayService.createUser({first_name:t.checkoutInfo.user_info.fname,last_name:t.checkoutInfo.user_info.lname,phone:t.checkoutInfo.user_info.phone,email:t.checkoutInfo.user_info.email}).subscribe({next:i=>{t.isFetchingAeroPay=!1,i.displayMessage?(t.verificationRequired=!0,t.existingUserId=i.existingUser.userId,t.presentToast(i.displayMessage,"warning")):i.success&&i.user&&(t.userBankAccounts=i.user.bankAccounts||[],t.aeropayUserId=i.user.userId,t.userBankAccounts.length>0?(t.showBankSelection=!0,t.selectedBankId=t.userBankAccounts[0].bankAccountId):t.retrieveAerosyncCredentials())},error:i=>{console.error("Error Creating AeroPay User:",i),t.presentToast("Error creating user. Please try again.","danger"),t.isFetchingAeroPay=!1}})})()}verifyAeroPayUser(){var t=this;return(0,h.A)(function*(){t.verificationCode.trim()?t.aeropayService.verifyUser(t.existingUserId,t.verificationCode).subscribe({next:n=>{t.verificationRequired=!1,t.presentToast("Verification successful!","success")},error:n=>{console.error("Verification Failed:",n),t.presentToast("Invalid verification code. Please try again.","danger")}}):t.presentToast("Please enter the verification code.","danger")})()}retrieveAerosyncCredentials(){var t=this;return(0,h.A)(function*(){t.loadingAerosync=!0,t.aeropayService.fetchUsedForMerchantToken(t.aeropayUserId).subscribe({next:n=>{if(!1===n.success||!n.token)return console.error("AeroPay Authentication Failed:",n.error),t.presentToast(`Authentication Error: ${n.error.message}`,"danger"),void(t.loadingAerosync=!1);t.aeropayService.getAerosyncCredentials().subscribe({next:i=>{i.success?(t.aerosyncURL=i.fastlinkURL,t.aerosyncToken=i.token,t.aerosyncUsername=i.username,t.openAerosyncWidget()):console.error("Failed to retrieve Aerosync widget."),t.loadingAerosync=!1},error:i=>{console.error("Error Retrieving Aerosync Widget:",i),t.loadingAerosync=!1}})},error:n=>{console.error("AeroPay Authentication Request Failed:",n),t.presentToast("Authentication request failed. Please try again.","danger"),t.loadingAerosync=!1}})})()}openAerosyncWidget(){this.aerosyncToken?function U(o){return new window.Aerosync(o)}({id:"widget",iframeTitle:"Connect",environment:"production",token:this.aerosyncToken,style:{width:"375px",height:"688px",bgColor:"#000000",opacity:.7},deeplink:"",consumerId:"",onLoad:function(){console.log("AeroSync Widget Loaded")},onSuccess:n=>{n.user_id&&n.user_password?this.linkBankToAeropay(n.user_id,n.user_password):console.error("Missing user credentials in event:",n)},onError:function(n){console.error("AeroSync Error:",n)},onClose:function(){console.log("AeroSync Widget Closed")},onEvent:function(n,i){console.log(n,i)}}).launch():console.error("Missing AeroSync Token")}linkBankToAeropay(t,n){this.aeropayService.linkBankAccount(t,n).subscribe({next:i=>{i.success?(this.presentToast("Bank account linked successfully!","success"),this.createAeroPayUser()):(console.error("Failed to link bank:",i),this.presentToast("Failed to link your bank. Please try again.","danger"))},error:i=>{console.error("Error linking bank account:",i),this.presentToast("An error occurred while linking your bank.","danger")}})}selectBank(t){this.selectedBankId=t}generateTimeOptions(){for(let t=8;t<=23;t++)this.timeOptions.push({value:(t<10?`0${t}`:`${t}`)+":00",display:`${t%12==0?12:t%12}:00 ${t<12?"AM":"PM"}`})}calculateDefaultTotals(){this.finalSubtotal=this.checkoutInfo.cart.reduce((t,n)=>t+n.price*n.quantity,0),this.finalTax=.13*this.finalSubtotal,this.finalTotal=this.finalSubtotal+this.finalTax}updateTotals(){const t=this.pointsToRedeem*this.pointValue,n=this.checkoutInfo.cart.reduce((i,s)=>i+s.price*s.quantity,0);this.finalSubtotal=n-t,this.finalSubtotal<0&&(this.finalSubtotal=0),this.finalTax=.13*this.finalSubtotal,this.finalTotal=this.finalSubtotal+this.finalTax,this.finalTotal>=90&&(this.enableDelivery=!0),this.accessibilityService.announce(`Subtotal updated to ${this.finalSubtotal.toFixed(2)} dollars.`,"polite")}goBack(){this.back.emit(),this.accessibilityService.announce("Returned to the previous page.","polite")}toggleDatePicker(){this.isDatePickerOpen=!this.isDatePickerOpen,this.accessibilityService.announce(this.isDatePickerOpen?"Date picker opened.":"Date picker closed.","polite")}toggleTooltip(){this.showTooltip=!this.showTooltip}onDateSelected(t){const n=new Date(t.detail.value);this.selectedDate=n.toLocaleDateString(void 0,{month:"long",day:"numeric"}),this.showTooltip=!1,this.accessibilityService.announce(`Selected date is ${this.selectedDate}.`,"polite")}placeOrder(){var t=this;return(0,h.A)(function*(){t.isLoading=!0;const n=yield t.loadingController.create({spinner:"crescent",message:"Please wait while we process your order...",cssClass:"custom-loading"});yield n.present();try{if(t.hasUserInfoChanged()){console.log("User info changed, creating Alleaves customer...");const M={fname:t.checkoutInfo.user_info.fname,lname:t.checkoutInfo.user_info.lname,phone:t.checkoutInfo.user_info.phone,email:t.checkoutInfo.user_info.email,dob:t.checkoutInfo.user_info.dob},C=yield t.cartService.createAlleavesCustomer(M);null!=C&&C.id_customer?(console.log("Alleaves Customer Created:",C.id_customer),t.checkoutInfo.user_info.alleaves_customer_id=C.id_customer):console.warn("Failed to create Alleaves Customer")}const i=t.checkoutInfo.user_info.id;console.log(t.checkoutInfo.user_info.alleaves_customer_id);const s=t.pointsToRedeem;let c=0,p=0;const k="delivery"===t.selectedOrderType?{address1:t.deliveryAddress.street.trim(),address2:t.deliveryAddress.apt?t.deliveryAddress.apt.trim():null,city:t.deliveryAddress.city.trim(),state:t.deliveryAddress.state.trim(),zip:t.deliveryAddress.zip.trim(),delivery_date:(new Date).toISOString().split("T")[0]}:null;"aeropay"===t.selectedPaymentMethod&&t.selectedBankId&&t.aeropayService.fetchUsedForMerchantToken(t.aeropayUserId).subscribe({next:(M=(0,h.A)(function*(C){const v=yield t.aeropayService.createTransaction(t.finalTotal.toFixed(2),t.selectedBankId).toPromise();if(!v||!v.success)return console.error("AeroPay Transaction Failed:",v),t.presentToast("Payment failed. Please try again.","danger"),t.isLoading=!1,void(yield n.dismiss());t.presentToast("Payment successful!","success")}),function(v){return M.apply(this,arguments)}),error:M=>{console.log("Error:",M),t.presentToast("Error","danger")}});const j=yield t.cartService.checkout(s,t.selectedOrderType,k);c=j.id_order,p=j.subtotal,yield t.cartService.placeOrder(i,c,s?0:p,s,t.finalSubtotal,t.checkoutInfo.cart),t.orderPlaced.emit(),yield t.authService.getUserOrders(),t.accessibilityService.announce("Your order has been placed successfully.","polite")}catch(i){console.error("Error placing order:",i),yield t.presentToast("Error placing order: "+JSON.stringify(i.message)),t.accessibilityService.announce("There was an error placing your order. Please try again.","polite")}finally{t.isLoading=!1,yield n.dismiss()}var M})()}hasUserInfoChanged(){return!!this.originalUserInfo&&(this.originalUserInfo.fname!==this.checkoutInfo.user_info.fname||this.originalUserInfo.lname!==this.checkoutInfo.user_info.lname||this.originalUserInfo.phone!==this.checkoutInfo.user_info.phone||this.originalUserInfo.email!==this.checkoutInfo.user_info.email||this.originalUserInfo.dob!==this.checkoutInfo.user_info.dob)}presentToast(t,n="danger"){var i=this;return(0,h.A)(function*(){yield(yield i.toastController.create({message:t,duration:5e3,color:n,position:"bottom"})).present()})()}onOrderTypeChange(t){this.selectedOrderType=t.detail.value,"delivery"===this.selectedOrderType&&(this.selectedPaymentMethod="aeropay",this.startAeroPayProcess())}onPaymentMethodChange(t){"aeropay"===t?this.startAeroPayProcess():this.showBankSelection=!1}}return(o=a).\u0275fac=function(t){return new(t||o)(e.rXU(b.m),e.rXU(l.Xi),e.rXU(O.s),e.rXU(l.K_),e.rXU(x.u),e.rXU(X))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-checkout"]],inputs:{checkoutInfo:"checkoutInfo"},outputs:{back:"back",orderPlaced:"orderPlaced"},decls:103,vars:38,consts:[[1,"checkout-container"],[1,"header"],["role","button","aria-label","Go back to the previous page",1,"back-button",3,"click"],["name","arrow-back-outline","aria-hidden","true"],[1,"section","contact-info"],[1,"input-row"],[1,"rounded-input","half-width"],["name","first","placeholder","First Name","aria-label","First Name",3,"ngModelChange","ngModel"],["name","last","placeholder","Last Name","aria-label","Last Name",3,"ngModelChange","ngModel"],[1,"rounded-input"],["name","email","type","email","placeholder","Email","aria-label","Email Address",3,"ngModelChange","ngModel"],["name","phone","type","tel","placeholder","Phone","aria-label","Phone Number",3,"ngModelChange","ngModel"],[1,"section","order-type"],["aria-label","Select Order Type",3,"ngModelChange","ionChange","ngModel"],["lines","none",1,"radio-item"],["slot","start","value","pickup","checked",""],["slot","start","value","delivery",3,"disabled"],["class","delivery-warning",4,"ngIf"],["class","delivery-address",4,"ngIf"],[1,"section","payment-method"],["aria-label","Select Payment Method",3,"ngModelChange","ngModel"],["slot","start","value","cash",3,"disabled"],["slot","start","value","card",3,"disabled"],["slot","start","value","aeropay"],[1,"aeropay-label"],["src","assets/aeropay.png","alt","Powered by Aeropay",1,"aeropay-image"],["class","loading-container",4,"ngIf"],["class","verification-container",4,"ngIf"],["class","aeropay-banks",4,"ngIf"],[1,"section","order-summary"],["aria-live","polite",1,"summary"],["lines","none",1,"points-slider"],["aria-label","Adjust points to redeem for discount",3,"ngModelChange","ionChange","ngModel","min","max","step"],["slot","start"],["slot","end"],[1,"section","cart-items"],["class","order-item",4,"ngFor","ngForOf"],["expand","block","aria-label","Place your order",1,"sticky-footer",3,"click","disabled"],["id","widget"],[1,"delivery-warning"],[1,"delivery-address"],["name","street","placeholder","Street Address","aria-label","Street Address",3,"ngModelChange","ngModel"],["name","apt","placeholder","Apartment / Suite (Optional)","aria-label","Apartment or Suite",3,"ngModelChange","ngModel"],["name","city","placeholder","City","aria-label","City",3,"ngModelChange","ngModel"],["name","zip","placeholder","ZIP Code","aria-label","ZIP Code",3,"ngModelChange","ngModel"],[1,"rounded-input","readonly-input"],[1,"loading-container"],["name","crescent"],[1,"verification-container"],["placeholder","Verification Code",3,"ngModelChange","ngModel"],[3,"click"],[1,"aeropay-banks"],[3,"selected-bank","click",4,"ngFor","ngForOf"],["expand","full","color","primary",3,"click"],["name","crescent",4,"ngIf"],[4,"ngIf"],["name","card-outline","size","large"],["name","checkmark-circle","color","success","slot","end",4,"ngIf"],["name","checkmark-circle","color","success","slot","end"],[1,"order-item"],[1,"item-image",3,"src","alt"],[1,"item-details"],[1,"item-quantity"],[1,"item-title"]],template:function(t,n){1&t&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.bIt("click",function(){return n.goBack()}),e.nrm(3,"ion-icon",3),e.k0s(),e.j41(4,"h1"),e.EFF(5,"Cart"),e.k0s()(),e.j41(6,"div",4)(7,"h2"),e.EFF(8,"Contact Information"),e.k0s(),e.j41(9,"form")(10,"div",5)(11,"ion-item",6)(12,"ion-input",7),e.mxI("ngModelChange",function(s){return e.DH7(n.checkoutInfo.user_info.fname,s)||(n.checkoutInfo.user_info.fname=s),s}),e.k0s()(),e.j41(13,"ion-item",6)(14,"ion-input",8),e.mxI("ngModelChange",function(s){return e.DH7(n.checkoutInfo.user_info.lname,s)||(n.checkoutInfo.user_info.lname=s),s}),e.k0s()()(),e.j41(15,"ion-item",9)(16,"ion-input",10),e.mxI("ngModelChange",function(s){return e.DH7(n.checkoutInfo.user_info.email,s)||(n.checkoutInfo.user_info.email=s),s}),e.k0s()(),e.j41(17,"ion-item",9)(18,"ion-input",11),e.mxI("ngModelChange",function(s){return e.DH7(n.checkoutInfo.user_info.phone,s)||(n.checkoutInfo.user_info.phone=s),s}),e.k0s()()()(),e.j41(19,"div",12)(20,"h2"),e.EFF(21,"Order Type"),e.k0s(),e.j41(22,"ion-radio-group",13),e.mxI("ngModelChange",function(s){return e.DH7(n.selectedOrderType,s)||(n.selectedOrderType=s),s}),e.bIt("ionChange",function(s){return n.onOrderTypeChange(s)}),e.j41(23,"ion-item",14),e.nrm(24,"ion-radio",15),e.j41(25,"ion-label"),e.EFF(26,"Pickup"),e.k0s()(),e.j41(27,"ion-item",14),e.nrm(28,"ion-radio",16),e.j41(29,"ion-label"),e.EFF(30,"Delivery"),e.k0s()()(),e.DNE(31,N,2,0,"p",17)(32,z,17,5,"div",18),e.k0s(),e.j41(33,"div",19)(34,"h2"),e.EFF(35,"Payment Method"),e.k0s(),e.j41(36,"ion-radio-group",20),e.mxI("ngModelChange",function(s){return e.DH7(n.selectedPaymentMethod,s)||(n.selectedPaymentMethod=s),s}),e.bIt("ngModelChange",function(s){return n.onPaymentMethodChange(s)}),e.j41(37,"ion-item",14),e.nrm(38,"ion-radio",21),e.j41(39,"ion-label"),e.EFF(40,"In Store - Cash"),e.k0s()(),e.j41(41,"ion-item",14),e.nrm(42,"ion-radio",22),e.j41(43,"ion-label"),e.EFF(44,"In Store - Debit"),e.k0s()(),e.j41(45,"ion-item",14),e.nrm(46,"ion-radio",23),e.j41(47,"ion-label",24),e.nrm(48,"img",25),e.DNE(49,Y,4,0,"div",26)(50,L,6,1,"div",27)(51,W,6,3,"div",28),e.k0s()()()(),e.j41(52,"div",29)(53,"h2"),e.EFF(54,"Order Summary"),e.k0s(),e.j41(55,"div",30)(56,"p"),e.EFF(57," Subtotal: "),e.j41(58,"span"),e.EFF(59),e.nI1(60,"currency"),e.k0s()(),e.j41(61,"p"),e.EFF(62," Available Points: "),e.j41(63,"span"),e.EFF(64),e.k0s()(),e.j41(65,"p"),e.EFF(66," Potential Savings: "),e.j41(67,"span"),e.EFF(68),e.nI1(69,"currency"),e.k0s()(),e.j41(70,"p"),e.EFF(71," Points to Redeem: "),e.j41(72,"span"),e.EFF(73),e.k0s()(),e.j41(74,"ion-item",31)(75,"ion-range",32),e.mxI("ngModelChange",function(s){return e.DH7(n.pointsToRedeem,s)||(n.pointsToRedeem=s),s}),e.bIt("ionChange",function(){return n.updateTotals()}),e.j41(76,"ion-label",33),e.EFF(77,"0"),e.k0s(),e.j41(78,"ion-label",34),e.EFF(79),e.k0s()()(),e.j41(80,"p"),e.EFF(81," Discount Applied: "),e.j41(82,"span"),e.EFF(83),e.nI1(84,"currency"),e.k0s()(),e.j41(85,"p"),e.EFF(86," Tax: "),e.j41(87,"span"),e.EFF(88),e.nI1(89,"currency"),e.k0s()(),e.j41(90,"p"),e.EFF(91," Total: "),e.j41(92,"span"),e.EFF(93),e.nI1(94,"currency"),e.k0s()()()(),e.j41(95,"div",35)(96,"h2"),e.EFF(97,"Your Items"),e.k0s(),e.j41(98,"ul"),e.DNE(99,K,7,4,"li",36),e.k0s()()(),e.j41(100,"ion-button",37),e.bIt("click",function(){return n.placeOrder()}),e.EFF(101," Submit Order\n"),e.k0s(),e.nrm(102,"div",38)),2&t&&(e.R7$(12),e.R50("ngModel",n.checkoutInfo.user_info.fname),e.R7$(2),e.R50("ngModel",n.checkoutInfo.user_info.lname),e.R7$(2),e.R50("ngModel",n.checkoutInfo.user_info.email),e.R7$(2),e.R50("ngModel",n.checkoutInfo.user_info.phone),e.R7$(4),e.R50("ngModel",n.selectedOrderType),e.R7$(6),e.Y8G("disabled",!n.enableDelivery),e.R7$(3),e.Y8G("ngIf",!n.enableDelivery),e.R7$(),e.Y8G("ngIf","delivery"===n.selectedOrderType),e.R7$(4),e.R50("ngModel",n.selectedPaymentMethod),e.R7$(2),e.Y8G("disabled","delivery"===n.selectedOrderType),e.R7$(4),e.Y8G("disabled","delivery"===n.selectedOrderType),e.R7$(7),e.Y8G("ngIf",n.isFetchingAeroPay),e.R7$(),e.Y8G("ngIf",n.verificationRequired),e.R7$(),e.Y8G("ngIf",n.showBankSelection),e.R7$(8),e.JRh(e.bMT(60,28,n.finalSubtotal)),e.R7$(5),e.JRh(n.checkoutInfo.user_info.points),e.R7$(4),e.JRh(e.bMT(69,30,n.checkoutInfo.user_info.points*n.pointValue)),e.R7$(5),e.JRh(n.pointsToRedeem),e.R7$(2),e.R50("ngModel",n.pointsToRedeem),e.Y8G("min",0)("max",n.checkoutInfo.user_info.points)("step",1),e.R7$(4),e.JRh(n.checkoutInfo.user_info.points),e.R7$(4),e.JRh(e.bMT(84,32,n.pointsToRedeem*n.pointValue)),e.R7$(5),e.JRh(e.bMT(89,34,n.finalTax)),e.R7$(5),e.JRh(e.bMT(94,36,n.finalTotal)),e.R7$(6),e.Y8G("ngForOf",n.checkoutInfo.cart),e.R7$(),e.Y8G("disabled","aeropay"===n.selectedPaymentMethod&&!n.selectedBankId))},dependencies:[m.Sq,m.bT,y.qT,y.BC,y.cb,y.vS,y.cV,l.mC,l.Jm,l.iq,l.$w,l.uz,l.he,l.nf,l.KO,l.f0,l.Ob,l.w2,l.IO,l.su,l.Je,l.Gw,m.oe],styles:[".checkout-container[_ngcontent-%COMP%]{padding:25px;margin-bottom:50px}.checkout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;margin-bottom:16px}.checkout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;font-size:1.2rem;color:#333;transition:color .2s ease-in-out}.checkout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.5rem}.checkout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]:hover{color:#4caf50}.checkout-container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{flex:1;text-align:center;font-size:2rem;font-weight:700;margin:0}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]{margin-bottom:24px;border-bottom:1px solid #ddd;padding-bottom:16px}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:700;margin-bottom:16px}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   .input-row[_ngcontent-%COMP%]{display:flex;gap:12px}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   .rounded-input[_ngcontent-%COMP%]{border-radius:8px;--padding-start: 12px;margin-bottom:16px;z-index:0}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   .radio-item[_ngcontent-%COMP%]{display:flex;padding:8px;border:1px solid #ddd;border-radius:8px;margin:12px 0 8px;align-items:flex-start;z-index:0}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   .radio-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-left:8px;font-weight:700}.checkout-container[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]   .radio-item[_ngcontent-%COMP%]   ion-radio[_ngcontent-%COMP%]{--size: 24px}.checkout-container[_ngcontent-%COMP%]   .aeropay-label[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start}.checkout-container[_ngcontent-%COMP%]   #aeropay-button-container[_ngcontent-%COMP%]{margin-top:10px}.checkout-container[_ngcontent-%COMP%]   .summary[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:1rem;margin-bottom:8px}.checkout-container[_ngcontent-%COMP%]   .summary[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700}.selected-bank[_ngcontent-%COMP%]{background:#0080001a;border-left:4px solid green;transition:background .3s ease,border-left .3s ease}.sticky-footer[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;width:100%;height:60px;color:#fff;font-size:1.2rem;font-weight:700;display:flex;justify-content:space-between;align-items:center;margin:0;border:none;--border-radius: 0px;z-index:1000}.footer-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%}.footer-content[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex:1;text-align:center}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.date-time-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:16px}.date-time-container[_ngcontent-%COMP%]   .date-picker-container[_ngcontent-%COMP%]{position:relative;flex:1;z-index:0}.date-time-container[_ngcontent-%COMP%]   .date-picker-container[_ngcontent-%COMP%]   .tooltip-calendar[_ngcontent-%COMP%]{position:absolute;top:50px;left:0;z-index:1050;background:#fff;border:1px solid #d1d1d1;border-radius:8px;box-shadow:0 4px 8px #0000001a;padding:8px;width:300px}.date-time-container[_ngcontent-%COMP%]   .enhanced-box[_ngcontent-%COMP%]{border-radius:8px;padding:12px;transition:transform .2s ease-in-out,box-shadow .2s ease-in-out}.date-time-container[_ngcontent-%COMP%]   .enhanced-box[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}.date-time-container[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{border-radius:8px;--padding-start: 12px;font-size:1rem}.aeropay-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;margin-top:16px}.aeropay-image[_ngcontent-%COMP%]{max-width:60%;margin-top:5px}.loading-container[_ngcontent-%COMP%]{display:flex;margin-top:20px}#widget[_ngcontent-%COMP%]{margin-top:20px}ion-radio[_ngcontent-%COMP%]::part(container){-webkit-appearance:none;-moz-appearance:none;appearance:none;display:inline-flex;width:24px;height:24px;border-radius:50%;border:2px solid #ccc;background-color:#fff}.cart-items[_ngcontent-%COMP%]{margin-top:20px}.cart-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0}.cart-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:15px;border-bottom:1px solid rgba(0,0,0,.3);padding-bottom:10px}.cart-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]   img.item-image[_ngcontent-%COMP%]{width:60px;height:60px;object-fit:cover;border-radius:8px;margin-right:15px}.cart-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]{display:flex;flex-direction:column}.cart-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]   .item-title[_ngcontent-%COMP%]{font-size:14px;font-weight:500}.cart-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]   .item-quantity[_ngcontent-%COMP%]{font-size:13px}.delivery-address[_ngcontent-%COMP%]{margin-top:16px;padding:16px;border-radius:8px;background-color:#f9f9f9;box-shadow:0 2px 5px #0000001a}.delivery-address[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;margin-bottom:12px}.delivery-address[_ngcontent-%COMP%]   .input-row[_ngcontent-%COMP%]{display:flex;gap:12px}.delivery-address[_ngcontent-%COMP%]   .rounded-input[_ngcontent-%COMP%]{border-radius:8px;--padding-start: 12px;margin-bottom:12px}.aeropay-banks[_ngcontent-%COMP%]{width:100%}"]}),a})();var ee=d(5083);function te(o,a){1&o&&(e.j41(0,"div",4),e.nrm(1,"ion-spinner",5),e.k0s())}function ne(o,a){if(1&o&&(e.j41(0,"li",16),e.nrm(1,"img",17),e.j41(2,"span"),e.EFF(3),e.k0s(),e.j41(4,"span"),e.EFF(5),e.k0s()()),2&o){const r=a.$implicit;e.R7$(),e.Y8G("src",r.image,e.B4B)("alt","Image of "+r.title),e.R7$(2),e.SpI("",r.quantity,"x"),e.R7$(2),e.JRh(r.title)}}function oe(o,a){if(1&o){const r=e.RV6();e.j41(0,"div",13)(1,"ul"),e.DNE(2,ne,6,4,"li",14),e.k0s(),e.j41(3,"button",15),e.bIt("click",function(){e.eBV(r);const n=e.XpG().$implicit,i=e.XpG(2);return e.Njj(i.reorder(n))}),e.EFF(4," Reorder "),e.k0s()()}if(2&o){const r=e.XpG().$implicit;e.R7$(2),e.Y8G("ngForOf",r.items),e.R7$(),e.BMQ("aria-label","Reorder items from order"+r.id_order)}}function ie(o,a){if(1&o){const r=e.RV6();e.j41(0,"div",8)(1,"div",9),e.bIt("click",function(){const n=e.eBV(r).index,i=e.XpG(2);return e.Njj(i.toggleExpand(n,"pending"))}),e.j41(2,"div",10)(3,"h3"),e.EFF(4),e.k0s(),e.j41(5,"p"),e.EFF(6),e.k0s()(),e.j41(7,"div",11)(8,"p"),e.EFF(9),e.nI1(10,"number"),e.k0s()()(),e.DNE(11,oe,5,2,"div",12),e.k0s()}if(2&o){const r=a.$implicit,t=a.index,n=e.XpG(2);e.AVh("expanded",n.expandedOrderIndex.pending===t),e.R7$(),e.BMQ("aria-expanded",n.expandedOrderIndex.pending===t)("aria-controls","pending-order-items-"+t)("aria-label","View details for order "+r.id_order),e.R7$(3),e.SpI("Order #",r.id_order,""),e.R7$(2),e.SpI("",r.items.length," items"),e.R7$(3),e.SpI("$",e.i5U(10,9,r.total,"1.2-2"),""),e.R7$(2),e.Y8G("ngIf",n.expandedOrderIndex.pending===t)}}function re(o,a){if(1&o&&(e.j41(0,"div",6),e.DNE(1,ie,12,12,"div",7),e.k0s()),2&o){const r=e.XpG();e.R7$(),e.Y8G("ngForOf",r.pendingOrders)}}function ae(o,a){1&o&&(e.j41(0,"div",4),e.nrm(1,"ion-spinner",5),e.k0s())}function se(o,a){if(1&o&&(e.j41(0,"li",16),e.nrm(1,"img",17),e.j41(2,"span"),e.EFF(3),e.k0s(),e.j41(4,"span"),e.EFF(5),e.k0s()()),2&o){const r=a.$implicit;e.R7$(),e.Y8G("src",r.image,e.B4B)("alt","Image of "+r.title),e.R7$(2),e.SpI("",r.quantity,"x"),e.R7$(2),e.JRh(r.title)}}function ce(o,a){if(1&o){const r=e.RV6();e.j41(0,"div",13)(1,"ul"),e.DNE(2,se,6,4,"li",14),e.k0s(),e.j41(3,"ion-button",15),e.bIt("click",function(){e.eBV(r);const n=e.XpG().$implicit,i=e.XpG(2);return e.Njj(i.reorder(n))}),e.EFF(4," Reorder "),e.k0s()()}if(2&o){const r=e.XpG().$implicit;e.R7$(2),e.Y8G("ngForOf",r.items),e.R7$(),e.BMQ("aria-label","Reorder items from order "+r.id_order)}}function le(o,a){if(1&o){const r=e.RV6();e.j41(0,"div",8)(1,"div",9),e.bIt("click",function(){const n=e.eBV(r).index,i=e.XpG(2);return e.Njj(i.toggleExpand(n,"past"))}),e.j41(2,"div",10)(3,"h3"),e.EFF(4),e.k0s(),e.j41(5,"p"),e.EFF(6),e.k0s(),e.j41(7,"p"),e.EFF(8),e.k0s()(),e.j41(9,"div",11)(10,"p"),e.EFF(11),e.nI1(12,"number"),e.k0s()()(),e.DNE(13,ce,5,2,"div",12),e.k0s()}if(2&o){const r=a.$implicit,t=a.index,n=e.XpG(2);e.AVh("expanded",n.expandedOrderIndex.past===t),e.R7$(),e.BMQ("aria-expanded",n.expandedOrderIndex.past===t)("aria-controls","past-order-items-"+t)("aria-label","View details for order "+r.id_order),e.R7$(3),e.SpI("Order #",r.id_order,""),e.R7$(2),e.SpI("",r.items.length," items"),e.R7$(2),e.Lme("Pickup: ",r.pickupDate," at ",r.pickupTime,""),e.R7$(3),e.SpI("$",e.i5U(12,11,r.total,"1.2-2"),""),e.R7$(2),e.Y8G("ngIf",n.expandedOrderIndex.past===t)}}function de(o,a){if(1&o&&(e.j41(0,"div",18),e.DNE(1,le,14,14,"div",7),e.k0s()),2&o){const r=e.XpG();e.R7$(),e.Y8G("ngForOf",r.pastOrders)}}let pe=(()=>{var o;class a{constructor(t,n,i,s){this.authService=t,this.cartService=n,this.accessibilityService=i,this.cdr=s,this.pendingOrders=[],this.pastOrders=[],this.loading=!0,this.expandedOrderIndex={pending:null,past:null}}ngOnInit(){this.loading=!0,this.authService.orders.subscribe(t=>{if(console.log("New orders received:",t),null===t)return this.pendingOrders=[],this.pastOrders=[],void(this.loading=!0);this.loading=!1,this.pendingOrders=t.filter(n=>!n.complete),this.pastOrders=t.filter(n=>n.complete)}),this.authService.getUserOrders().then(()=>{console.log("Orders refreshed.")})}getLatestStatus(t){return t.status_list&&t.status_list.length>0?t.status_list.reduce((n,i)=>new Date(i.created_at)>new Date(n.created_at)?i:n).customer_message:""}sendStatusNotification(t,n){return(0,h.A)(function*(){const i={userId:t,title:"Order Update",body:`Your order status: ${n}`},s=localStorage.getItem("sessionData"),p={Authorization:s?JSON.parse(s).token:null,"Content-Type":"application/json"};try{yield ee.pX.post({url:`${g.c.apiUrl}/notifications/send-push`,headers:p,data:i}),console.log("Order status notification sent:",n)}catch(k){console.error("Error sending notification",k)}})()}toggleExpand(t,n){const i=this.expandedOrderIndex[n]===t;this.expandedOrderIndex[n]=i?null:t,this.accessibilityService.announce(i?`Order ${n} #${t+1} collapsed.`:`Order ${n} #${t+1} expanded.`,"polite")}reorder(t){t.items.forEach(i=>{this.cartService.addToCart({id:i.id,posProductId:i.posProductId,image:i.image,brand:i.brand,desc:i.desc,price:i.price,quantity:i.quantity,title:i.title,strainType:i.strainType,thc:i.thc,weight:i.weight,category:i.category})}),this.accessibilityService.announce(`Order #${t.id_order} items have been added to your cart.`,"assertive"),console.log("Order added to cart:",t)}}return(o=a).\u0275fac=function(t){return new(t||o)(e.rXU(x.u),e.rXU(b.m),e.rXU(O.s),e.rXU(e.gRc))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-recent-orders"]],decls:9,vars:4,consts:[[1,"order-history"],["class","loading-container",4,"ngIf"],["class","order-list","role","region","aria-labelledby","pending-orders-heading",4,"ngIf"],["class","order-list","role","region","aria-labelledby","past-orders-heading",4,"ngIf"],[1,"loading-container"],["name","crescent"],["role","region","aria-labelledby","pending-orders-heading",1,"order-list"],["class","order-card",3,"expanded",4,"ngFor","ngForOf"],[1,"order-card"],[1,"order-header",3,"click"],[1,"order-info"],[1,"order-amount"],["class","order-items",4,"ngIf"],[1,"order-items"],["class","order-item",4,"ngFor","ngForOf"],[1,"reorder-button",3,"click"],[1,"order-item"],[1,"item-image",3,"src","alt"],["role","region","aria-labelledby","past-orders-heading",1,"order-list"]],template:function(t,n){1&t&&(e.j41(0,"div",0)(1,"h2"),e.EFF(2,"Pending Orders"),e.k0s(),e.DNE(3,te,2,0,"div",1)(4,re,2,1,"div",2),e.j41(5,"h2"),e.EFF(6,"Past Orders"),e.k0s(),e.DNE(7,ae,2,0,"div",1)(8,de,2,1,"div",3),e.k0s()),2&t&&(e.R7$(3),e.Y8G("ngIf",n.loading),e.R7$(),e.Y8G("ngIf",!n.loading),e.R7$(3),e.Y8G("ngIf",n.loading),e.R7$(),e.Y8G("ngIf",!n.loading))},dependencies:[m.Sq,m.bT,l.Jm,l.w2,m.QX],styles:[".order-history[_ngcontent-%COMP%]{width:100%;max-width:600px;margin:0 auto;padding:16px;font-family:Arial,sans-serif}.order-history[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;margin-bottom:24px}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:8px;background-color:#fff;overflow:hidden;transition:max-height .3s ease}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card.expanded[_ngcontent-%COMP%]{max-height:500px}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;cursor:pointer}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-header[_ngcontent-%COMP%]   .order-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;margin:0}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-header[_ngcontent-%COMP%]   .order-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;margin:4px 0}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-header[_ngcontent-%COMP%]   .order-amount[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1rem;font-weight:700;margin:0;text-align:right}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-items[_ngcontent-%COMP%]{padding:20px}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:10px}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]   img.item-image[_ngcontent-%COMP%]{width:40px;height:40px;object-fit:cover;border-radius:4px;margin-right:10px}.order-history[_ngcontent-%COMP%]   .order-list[_ngcontent-%COMP%]   .order-card[_ngcontent-%COMP%]   .order-items[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .order-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-right:10px;font-size:14px}.reorder-button[_ngcontent-%COMP%]{background-color:var(--ion-color-primary);color:#fff;border:none;padding:10px 15px;margin-top:10px;border-radius:5px;cursor:pointer;font-size:14px}.loading-container[_ngcontent-%COMP%]{text-align:center;margin:auto}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:20px;color:#000;text-align:center;margin:auto}"]}),a})();function ue(o,a){if(1&o){const r=e.RV6();e.qex(0),e.nrm(1,"app-cart-items",3),e.j41(2,"div",4)(3,"ion-button",5),e.bIt("click",function(){e.eBV(r);const n=e.XpG(2);return e.Njj(n.checkout())}),e.EFF(4,"Continue"),e.k0s()(),e.bVm()}if(2&o){const r=e.XpG(2);e.R7$(),e.Y8G("items",r.cartItems)}}function ge(o,a){1&o&&(e.j41(0,"div",6),e.nrm(1,"ion-icon",7),e.j41(2,"p"),e.EFF(3,"Your cart is empty!"),e.k0s(),e.j41(4,"ion-button",8),e.EFF(5,"Browse Products"),e.k0s()())}function he(o,a){if(1&o&&(e.j41(0,"div"),e.DNE(1,ue,5,1,"ng-container",2)(2,ge,6,0,"ng-template",null,0,e.C5r),e.nrm(4,"app-recent-orders"),e.k0s()),2&o){const r=e.sdS(3),t=e.XpG();e.R7$(),e.Y8G("ngIf",t.cartItems.length>0)("ngIfElse",r)}}function me(o,a){if(1&o){const r=e.RV6();e.j41(0,"div")(1,"app-checkout",9),e.bIt("back",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.removeCheckout())})("orderPlaced",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.onOrderPlaced())}),e.k0s()()}if(2&o){const r=e.XpG();e.R7$(),e.Y8G("checkoutInfo",r.checkoutInfo)}}const _e=[{path:"",component:(()=>{var o;class a{constructor(t,n,i,s,c,p){this.cartService=t,this.toastController=n,this.loadingController=i,this.authService=s,this.accessibilityService=c,this.employeeService=p,this.showCheckout=!1,this.showConfirmation=!1,this.checkoutUrl="",this.cartItems=[],this.isLoading=!1}ngOnInit(){this.cartService.cart$.subscribe(t=>{this.cartItems=t}),this.employeeService.selectedUser$.subscribe(t=>{console.log(t),this.selectedUser=t})}checkout(){var t=this;return(0,h.A)(function*(){var n;t.isLoading=!0;const i=yield t.loadingController.create({message:"Processing Checkout...",spinner:"crescent"});yield i.present(),console.log(t.selectedUser),t.checkoutInfo={cart:t.cartItems,user_info:null!==(n=t.selectedUser)&&void 0!==n?n:t.authService.getCurrentUser()},console.log(t.checkoutInfo),t.showCheckout=!0,i.dismiss(),t.accessibilityService.announce("Checkout process started.","polite")})()}removeCheckout(){this.showCheckout=!1,this.accessibilityService.announce("Returned to cart.","polite")}onOrderPlaced(){var t=this;return(0,h.A)(function*(){t.showCheckout=!1,yield t.presentToast("Your order has been placed successfully!"),t.resetCart(),t.scrollToTop(),t.accessibilityService.announce("Your order was placed successfully.","polite")})()}ionViewDidEnter(){this.scrollToTop()}scrollToTop(){this.content?this.content.scrollToTop(300):console.warn("IonContent is not available.")}presentToast(t,n="success"){var i=this;return(0,h.A)(function*(){yield(yield i.toastController.create({message:t,duration:5e3,color:n,position:"bottom"})).present()})()}resetCart(){this.cartService.clearCart(),this.cartItems=[],this.checkoutInfo=null,this.accessibilityService.announce("Your cart has been cleared.","polite")}}return(o=a).\u0275fac=function(t){return new(t||o)(e.rXU(b.m),e.rXU(l.K_),e.rXU(l.Xi),e.rXU(x.u),e.rXU(O.s),e.rXU(A.O))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-cart"]],viewQuery:function(t,n){if(1&t&&e.GBs(l.W9,5),2&t){let i;e.mGM(i=e.lsd())&&(n.content=i.first)}},decls:4,vars:2,consts:[["emptyCart",""],[4,"ngIf"],[4,"ngIf","ngIfElse"],[3,"items"],[1,"checkout-container"],["aria-label","Proceed to checkout",1,"checkout-button",3,"click"],["role","alert","aria-live","polite",1,"empty-cart-message"],["name","cart-outline","size","large","aria-hidden","true"],["routerLink","/products","aria-label","Browse available products"],["aria-label","Checkout section",3,"back","orderPlaced","checkoutInfo"]],template:function(t,n){1&t&&(e.j41(0,"ion-content"),e.nrm(1,"app-header"),e.DNE(2,he,5,2,"div",1)(3,me,2,1,"div",1),e.k0s()),2&t&&(e.R7$(2),e.Y8G("ngIf",!n.showCheckout&&!n.showConfirmation),e.R7$(),e.Y8G("ngIf",n.showCheckout))},dependencies:[m.bT,l.Jm,l.W9,l.iq,l.N7,P.Wk,w.l,S,Z,pe],styles:[".checkout-container[_ngcontent-%COMP%]{width:100%;text-align:right;padding:16px}.checkout-container[_ngcontent-%COMP%]   .checkout-button[_ngcontent-%COMP%]{text-transform:capitalize;margin-left:auto;width:40%}.empty-cart-message[_ngcontent-%COMP%]{text-align:center;padding:40px 20px}.empty-cart-message[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px;color:#ccc}.empty-cart-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:18px;color:#666;margin-top:10px}.empty-cart-message[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-top:20px}"]}),a})()}];let fe=(()=>{var o;class a{}return(o=a).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[P.iI.forChild(_e),P.iI]}),a})();var Ce=d(3887);let ye=(()=>{var o;class a{}return(o=a).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[m.MD,y.YN,l.bv,fe,Ce.G]}),a})()}}]);